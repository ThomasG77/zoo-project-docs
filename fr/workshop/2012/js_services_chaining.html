<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Playing with buildign blocks - Creating JavaScript Web Services &mdash; ZOO Project 1.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="ZOO Project 1.3 documentation" href="../../index.html" />
    <link rel="up" title="Practical Introduction to ZOO-Project by playing with building blocks" href="index.html" />
    <link rel="next" title="ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting" href="../2013/index.html" />
    <link rel="prev" title="Presenting building blocks - Using OGR based Web Services" href="building_blocks_presentation.html" />

<script type="text/javascript">
$(document).ready(function(){

	$("ul.topnav li a").hover(function() {

		//Following events are applied to the subnav itself (moving subnav up and down)
		$(this).parent().find("ul.subnav").slideDown('fast').show(); //Drop down the subnav on click

		$(this).parent().hover(function() {
		}, function(){
			$(this).parent().find("ul.subnav").slideUp('slow'); //When the mouse hovers out of the subnav, move it back up
		});

		//Following events are applied to the trigger (Hover events for the trigger)
		}).hover(function() {
			$(this).addClass("subhover"); //On hover over, add class "subhover"
		}, function(){	//On Hover Out
			$(this).removeClass("subhover"); //On hover out, remove class "subhover"
	});

});
</script>

     

  </head>
  <body>
<!-- Begin Header -->
<div id="wrapper">
  	<div id="myheader">
    	<div class="hleft">
    	  <h1 class="title">Open WPS Platform</h1>
    	</div>
    	<div class="hright">
    	</div>
  	</div>
</div>
<ul class="topnav">
  <li><a href="http://www.zoo-project.org/">Home</a></li>
  <li><a href="#">ZOO Project</a>
       <ul class="subnav">

         <li><a href="/site/ZooWebSite/ZooProject/About">About</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Tribe">ZOO Tribe</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Events">Events</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Photos">Photos</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Contact">Contacts</a></li>
       </ul>

  </li>
  <li>
    <a href="#">Components</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/ZooKernel">ZOO Kernel</a></li>
      <li><a href="/site/ZooWebSite/ZooServices">ZOO Services</a></li>
      <li><a href="/site/ZooWebsite/ZooApi">ZOO API</a></li>

    </ul>
  </li>
  <li><a href="/site/Downloads">Download</a></li>
  <li><a href="#">Docs</a>
    <ul class="subnav">
      <li><a href="../../../en/index.html">English</a></li>
      <li><a href="../../../fr/index.html">Français</a></li>
    </ul>
  </li>
  <li><a href="#">Demos</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/Demo/SpatialTools">ZOO Spatial Tools</a></li>

      <li><a href="/site/ZooWebSite/Demo/CGAL">ZOO CGAL Vor</a></li>
      <li><a href="/site/ZooWebSite/Demo/WFS-T">ZOO Mapserver WFS-T</a></li>
      <li><a href="/site/ZooWebSite/Demo/GdalProfile">ZOO Elevation Profile</a></li>
      <li><a href="/site/ZooWebSite/Demo/FormTools">ZOO Form tools</a></li>
    </ul>
  </li>
  <li><a href="/trac">Trac</a></li>
</ul>
<!-- End Header -->
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../2013/index.html" title="ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="building_blocks_presentation.html" title="Presenting building blocks - Using OGR based Web Services"
             accesskey="P">précédent</a> |</li>
        <li><a href="../../index.html">ZOO Docs</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Practical Introduction to ZOO-Project by playing with building blocks</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="playing-with-buildign-blocks-creating-javascript-web-services">
<span id="ogr-base-vect-ops"></span><h1><a class="toc-backref" href="#table-of-contents">Playing with buildign blocks - Creating JavaScript Web Services</a><a class="headerlink" href="#playing-with-buildign-blocks-creating-javascript-web-services" title="Lien permanent vers ce titre">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#playing-with-buildign-blocks-creating-javascript-web-services" id="id11">Playing with buildign blocks - Creating JavaScript Web Services</a><ul>
<li><a class="reference internal" href="#introduction" id="id12">Introduction</a></li>
<li><a class="reference internal" href="#zoo-api-overview" id="id13">ZOO-API Overview</a></li>
<li><a class="reference internal" href="#the-mask-service" id="id14">The Mask Service</a><ul>
<li><a class="reference internal" href="#the-zcfg" id="id15">The ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-service" id="id16">The JavaScript service</a></li>
<li><a class="reference internal" href="#publish-and-use-your-service" id="id17">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buffermask-service" id="id18">BufferMask Service</a><ul>
<li><a class="reference internal" href="#id5" id="id19">The ZCFG</a></li>
<li><a class="reference internal" href="#id6" id="id20">The JavaScript service</a></li>
<li><a class="reference internal" href="#id7" id="id21">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bufferrequest-service" id="id22">BufferRequest service</a><ul>
<li><a class="reference internal" href="#id9" id="id23">The ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-code" id="id24">The JavaScript code</a></li>
<li><a class="reference internal" href="#id10" id="id25">Publish and use your Service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#conclusion" id="id26">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>This section illustrate how you can use JavaScript on the server-side to chain
services together to build new ones. You will create a ZOO Services Provider
using the services you seen before and the WFS server using the ZOO-API. The
final goal is to query all POIs included in a buffer around a feature and
to highlight them using a mask around this buffer. The following screenshot show
you the expected result:</p>
<a class="reference internal image-reference" href="../../_images/BufferMaskAndRequest_Level_15.png"><img alt="../../_images/BufferMaskAndRequest_Level_15.png" class="align-center" src="../../_images/BufferMaskAndRequest_Level_15.png" style="width: 650px;" /></a>
<p>You can decompose the result above in two different ones: the mask around the
buffer and the points included in the buffer. So you will create two different
Services: one called <tt class="docutils literal"><span class="pre">BufferMask</span></tt> and another one called <tt class="docutils literal"><span class="pre">BufferRequest</span></tt>.</p>
<p>But before implementing any JavaScript Service, you will get an overview of how
to use ZOO-API from your ZOO-Project installation in the next section.</p>
<p>As before, you first create a new directory to store files for your new Services
Provider named <tt class="docutils literal"><span class="pre">ws2012js</span></tt>:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">zoo</span><span class="o">-</span><span class="n">ws</span><span class="o">-</span><span class="mi">2012</span><span class="o">/</span><span class="n">zoo</span><span class="o">-</span><span class="n">project</span><span class="o">/</span><span class="n">zoo</span><span class="o">-</span><span class="n">services</span><span class="o">/</span><span class="n">ws2012js</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">env</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="zoo-api-overview">
<h2><a class="toc-backref" href="#table-of-contents">ZOO-API Overview</a><a class="headerlink" href="#zoo-api-overview" title="Lien permanent vers ce titre">¶</a></h2>
<p>ZOO-API and ZOO-Kernel JavaScript support make you able to run services
implemented in JavaScript on the server side. JavaScript is a popular programing
language but mostly used on the client side. Let say from a browser, but here it
is a bit different.</p>
<p>To support JavaScript language ZOO-Kernel use the
<a class="reference external" href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a> API to create a
javascript runtime environment from which it will load your JS file then extract
the function corresponding to the service to run it using the prefilled
parameters. The JavaScript runtime environment created by the ZOO-Kernel
depend on your setup. If you placed the <tt class="docutils literal"><span class="pre">ZOO-api.js</span></tt> and <tt class="docutils literal"><span class="pre">ZOO-proj4js.js</span></tt> in
the same directory as your ZOO-Kernel it means that your environment will
contains ZOO-API and Proj4js will be loaded before your service. In such case you can access to the Classes defined in the JavaScript ZOO-API
to manipulate geographic data, for more informations please refer to the
<a class="reference external" href="http://zoo-project.org/docs/api/index.html">ZOO-API Documentation</a>.</p>
<p>Even if it can be useful to run JavaScript on the server side, you should
remember that some basic JavaScript functions you are familiar with does not
exist or get a different behavior. For instance the simple <tt class="docutils literal"><span class="pre">alert</span></tt>
function will display messages in apache error logs rather than in a window when
used from a browser. The <tt class="docutils literal"><span class="pre">alert</span></tt> function can be used as follow:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">alert</span><span class="p">(</span><span class="s">&quot;My alert message&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>There is no XMLHttpRequest available in the JavaScript evironement your service
will run into. Hopefully, the ZOO-Kernel expose a C function to the JavaScript
world named: <tt class="docutils literal"><span class="pre">JSRequest</span></tt>. This function make you able from your JavaScript
services to call other WPS services (locally or remotelly) or other kind OGC
services such as WFS. When you are using the ZOO-API it is possible to call
Services using a <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt> instance <a class="footnote-reference" href="#f3" id="id1">[1]</a>, to parse WPS Responses using
<tt class="docutils literal"><span class="pre">ZOO.Format.WPS</span></tt>
(cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html">ref</a>).</p>
<p>As for Python services you already seen in previous sections, the functions
corresponding to a Service should take three arguments: <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> and
<tt class="docutils literal"><span class="pre">outputs</span></tt> <a class="footnote-reference" href="#f4" id="id2">[2]</a>. Nevertheless, as the ZOO-Kernel is not able to access the
values modified <a class="footnote-reference" href="#f5" id="id3">[3]</a> by the Service code, rather than returning an integer as
in Python, here you&#8217;ll need to return both the integer value representing the
Status of your Service in a JavaScript Object and the resulting <tt class="docutils literal"><span class="pre">outputs</span></tt>
values as an Object. You can see in the following an example of a JavaScript
Service code:</p>
<div class="highlight-none"><div class="highlight"><pre>function SampleService(conf,inputs,outputs){
  var resultValue=someComputation(inputs);
  return
    {
        result: ZOO.SERVICE_SUCCEEDED,
        outputs: { &quot;Result&quot;: { &quot;mimeType&quot;: &quot;application/json&quot;, &quot;value&quot;: resultValue } }
    };
}
</pre></div>
</div>
<p>Before starting to implement the Services we will need to get our final
BufferRequest service, let start with a simplier one.</p>
</div>
<div class="section" id="the-mask-service">
<h2><a class="toc-backref" href="#table-of-contents">The Mask Service</a><a class="headerlink" href="#the-mask-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>In this section you will learn how to create your first JavaScript service which
will simply return a rectangular mask around a selected feature. To build this
mask you will use the Buffer service to create a buffer big enough around a
selected geometry to cover a significant part of your map. You can see the
expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="../../_images/Mask_Level_12.png"><img alt="../../_images/Mask_Level_12.png" class="align-center" src="../../_images/Mask_Level_12.png" style="width: 650px;" /></a>
<p>As before, you will first start by writting the ZCFG, then you will write the
JavaScript source code and finish by publishing your Services Provider.</p>
<div class="section" id="the-zcfg">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#the-zcfg" title="Lien permanent vers ce titre">¶</a></h3>
<p>Open the file named
<tt class="docutils literal"><span class="pre">~/zoo-ws-2012/src/zoo-project/zoo-services/ws2012js/cgi-env/Mask.zcfg</span></tt>
with your favorite text editor and add the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[Mask]
 Title = Compute mask
 Abstract = Compute mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>Here you simply define one default <tt class="docutils literal"><span class="pre">ComplexData</span></tt> for both <tt class="docutils literal"><span class="pre">inputData</span></tt> and
<tt class="docutils literal"><span class="pre">Result</span></tt>: a GML and a GeoJSON respectively <a class="footnote-reference" href="#f6" id="id4">[4]</a>.</p>
</div>
<div class="section" id="the-javascript-service">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript service</a><a class="headerlink" href="#the-javascript-service" title="Lien permanent vers ce titre">¶</a></h3>
<p>As you will have to request the Buffer service many times from your service, you
will first define a <tt class="docutils literal"><span class="pre">Buffer</span></tt> function as follow. It uses the <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt>
to request the Buffer service you seen in the previous section.</p>
<p>Open a file named
<tt class="docutils literal"><span class="pre">~/zoo-ws-2012/src/zoo-project/zoo-services/ws2012js/cgi-env/foss4gws.js</span></tt> and
add the following content:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">zoo_url</span><span class="o">=</span><span class="s1">&#39;http://localhost/cgi-bin/zoo_loader.cgi&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mapserv_url</span><span class="o">=</span><span class="s1">&#39;http://localhost/cgi-bin/mapserv?&#39;</span><span class="o">+</span>
    <span class="s1">&#39;map=/var/www/zoows-demo/map/w2011.map&amp;amp;SERVICE=WFS&#39;</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="nx">bDist</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">JSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fWPS</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">WPS</span><span class="p">();</span>

  <span class="c1">// Pass the value as json</span>
  <span class="kd">var</span> <span class="nx">myInputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">inputData</span><span class="p">),</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;ResponseDocument&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;BufferPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult</span><span class="o">=</span><span class="nx">myProcess</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs</span><span class="p">,</span><span class="nx">myOutputs</span><span class="p">);</span>

  <span class="c1">// Parse the result and extract JSON geometry</span>
  <span class="kd">var</span> <span class="nx">bufferResult</span><span class="o">=</span><span class="nx">fWPS</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">myExecuteResult</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsGeoJSON</span><span class="o">=</span><span class="nx">fJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">bufferResult</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">bufferResultAsGeoJSON</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>From line 12 to 15, you give a GeoJSON string (created from <tt class="docutils literal"><span class="pre">inputData</span></tt>) for
InputPolygon and, on line 14, you set the BufferDistance value to <tt class="docutils literal"><span class="pre">bDist</span></tt>.
On line 16, you define Result as a ResponseDocument, so you&#8217;ll have to parse the
WPS response using the ZOO.Format.WPS, on line 21.</p>
<p>On line 17, you create a
<a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html#zoo-process">ZOO.Process</a>
instance providing the ZOO-Kernel url and the Service name. Then, on line 18, you
run the request passing inputs and outputs previously defined (from line 12 to 15).</p>
<p>Now, you get your <tt class="docutils literal"><span class="pre">Buffer</span></tt> function, it is time to create your first JavaScript
service. So, edit your <tt class="docutils literal"><span class="pre">foss4gws.js</span></tt> file you created before and add the following content:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">Mask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX and store its geometry in a ZOO.Feature</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>

  <span class="c1">// Return the created feature</span>
  <span class="k">return</span> <span class="p">{</span>
      <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
      <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="publish-and-use-your-service">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#publish-and-use-your-service" title="Lien permanent vers ce titre">¶</a></h3>
<p>Now you get both your ZCFG and your service code ready, you need to deploy your
new Services Provider using the following command:</p>
<div class="highlight-bash"><div class="highlight"><pre>cp ~/zoo-ws-2012/src/zoo-project/zoo-services/ws2012js/cgi-env/* /usr/lib/cgi-bin
</pre></div>
</div>
<p>Now you are ready to use your JavaScript service by loading the the following <a class="reference external" href="http://localhost/zoows-demo/spatialtools.html">url</a>, click on a street then click on
the &#8220;Mask&#8221; button.</p>
</div>
</div>
<div class="section" id="buffermask-service">
<h2><a class="toc-backref" href="#table-of-contents">BufferMask Service</a><a class="headerlink" href="#buffermask-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>In this section you will implement a simple JavaScript service which will be able create
a hole in the mask you created in <a class="reference external" href="#mask-service">previous section</a>. This service
will be used to highlight the buffer zone around a selected fature. You get a preview of
the expected result in the following screenshot:</p>
<a class="reference internal image-reference" href="../../_images/BufferMask_Level_15.png"><img alt="../../_images/BufferMask_Level_15.png" class="align-center" src="../../_images/BufferMask_Level_15.png" style="width: 650px;" /></a>
<div class="section" id="id5">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#id5" title="Lien permanent vers ce titre">¶</a></h3>
<p>Open the file named
<tt class="docutils literal"><span class="pre">~/zoo-ws-2012/src/zoo-project/zoo-services/ws2012js/cgi-env/BufferMask.zcfg</span></tt>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferMask]
 Title = Compute buffer mask
 Abstract = Compute buffer mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>This ZCFG is similar to the previous one. Please, refer to comments in the
<a class="reference external" href="#the-zcfg">previous section</a> for more informations.</p>
</div>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript service</a><a class="headerlink" href="#id6" title="Lien permanent vers ce titre">¶</a></h3>
<p>In this Service you will use same source code (until line 19) you used in the
<a class="reference external" href="#the-javascript-service">previous section</a>. Indeed, you should compute the Mask
as you did before then compute Buffer for creating a hole in the mask (on line 22) to run
the Difference service (from line 25 to 40).</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">function</span> <span class="nx">BufferMask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

   <span class="c1">// Create all required ZOO.formats</span>
   <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

   <span class="c1">// Read the input GML</span>
   <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="cp">[</span><span class="s2">&quot;InputData&quot;</span><span class="cp">][</span><span class="s2">&quot;value&quot;</span><span class="cp">]</span><span class="p">);</span>

   <span class="c1">// Compute Buffer</span>
   <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

   <span class="c1">// Create the Buffer result BBOX</span>
   <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
   <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
     <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="cp">[</span><span class="nb">t</span><span class="cp">]</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>

  <span class="c1">// Compute Buffer standard buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Request Difference service using Buffer result and features in the BBOX</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;DifferencePy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">finalG</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">},</span>
      <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>  <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

   <span class="c1">// Return the bbox</span>
   <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
   <span class="k">return</span> <span class="p">{</span>
       <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
       <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span> <span class="p">}</span> <span class="p">}</span>
   <span class="p">};</span>

 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-your-service">before</a>. To
use your service, please use the following <a class="reference external" href="http://localhost/zoows-demo/spatialtools.html">url</a>.</p>
</div>
</div>
<div class="section" id="bufferrequest-service">
<h2><a class="toc-backref" href="#table-of-contents">BufferRequest service</a><a class="headerlink" href="#bufferrequest-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>In this section, you will create a new Service: <tt class="docutils literal"><span class="pre">BufferRequest</span></tt> which will request
POIs included in the Buffer around a selected feature <a class="footnote-reference" href="#f7" id="id8">[5]</a>. You will use the <tt class="docutils literal"><span class="pre">poi</span></tt>
layer served as WFS through your local mapserver installation. You can see in the
following screenshot the expected result:</p>
<a class="reference internal image-reference" href="../../_images/BufferRequest_Level_15.png"><img alt="../../_images/BufferRequest_Level_15.png" class="align-center" src="../../_images/BufferRequest_Level_15.png" style="width: 650px;" /></a>
<div class="section" id="id9">
<h3><a class="toc-backref" href="#table-of-contents">The ZCFG</a><a class="headerlink" href="#id9" title="Lien permanent vers ce titre">¶</a></h3>
<p>Open the file named
<tt class="docutils literal"><span class="pre">~/zoo-ws-2012/zoo-project/zoo-services/ws2011js/cgi-env/BufferRequest.zcfg</span></tt>
with your favorite text editor and copy / paste the following content:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferRequest]
 Title = Compute buffer request
 Abstract = Compute buffer request around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="the-javascript-code">
<h3><a class="toc-backref" href="#table-of-contents">The JavaScript code</a><a class="headerlink" href="#the-javascript-code" title="Lien permanent vers ce titre">¶</a></h3>
<p>As in the previous Service, you will compute a buffer around the input feature. But then
you will request POIs available in the Buffer extent using a WFS request to use them to
run <tt class="docutils literal"><span class="pre">Intersection</span></tt> service using the initial Buffer. The WFS request is useful to limit
the number of points to use when requesting the <tt class="docutils literal"><span class="pre">Intersection</span></tt> Service.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">BufferRequest</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="c1">// Request Intersection service using Buffer result and WFS request using the</span>
  <span class="c1">// BBOX</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;IntersectionPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">req</span><span class="o">=</span><span class="s2">&quot;&amp;amp;version=1.0.0&amp;amp;request=GetFeature&amp;amp;typename=poi1&quot;</span><span class="p">;</span>
  <span class="nx">req</span><span class="o">+=</span><span class="s2">&quot;&amp;amp;SRS=EPSG:4326&amp;amp;BBOX=&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">},</span>
    <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">xlink</span><span class="o">:</span> <span class="nx">mapserv_url</span><span class="o">+</span><span class="nx">req</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">bottom</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">right</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;text/xml&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
    <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Result&quot;</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span><span class="p">}</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">to take advantage of the ZOO-Kernel cache system, you directly use the WFS
request  as <tt class="docutils literal"><span class="pre">xlink:href</span></tt> rather than value for <tt class="docutils literal"><span class="pre">InputEntity2</span></tt> (from line 31 to 34) and use <tt class="docutils literal"><span class="pre">text/xml</span></tt> <tt class="docutils literal"><span class="pre">mimeType</span></tt>
(on line 40). Indeed, the ZOO-API doesn&#8217;t use the internal cache mechanisms.</p>
</div>
</div>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#table-of-contents">Publish and use your Service</a><a class="headerlink" href="#id10" title="Lien permanent vers ce titre">¶</a></h3>
<p>Now, you can publish your service as you did <a class="reference external" href="#publish-your-service">before</a>. To
use your service, please use the following <a class="reference external" href="http://localhost/zoows-demo/spatialtools.html">url</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can click on &#8220;Buffer Request and Mask&#8221;  to get the same result as presented
in  <a class="reference external" href="#introduction">the initial screenshot</a>.</p>
</div>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#table-of-contents">Conclusion</a><a class="headerlink" href="#conclusion" title="Lien permanent vers ce titre">¶</a></h2>
<p>After understanding how basic Geometric Operation Services works, here you built step by
step new JavaScript services which reuse the previous ones and combine them in
different ways. This was achieved using the ZOO-API, composed by C functions
exposed by the ZOO-Kernel to the JavaScript services runtime environement and
the JS files which can be optionally installed.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>The <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt> class uses <tt class="docutils literal"><span class="pre">JSRequest</span></tt> (cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-format-wps.html">ref</a>). You will get example
of use <a class="reference external" href="#the-javascript-service">later</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>So <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> and <tt class="docutils literal"><span class="pre">outputs</span></tt> are simple JavaScript objects, similar
to the Python dictionaries used in the <a class="reference external" href="ogr_base_vect_ops.html">previous section</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td>Such as <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> and <tt class="docutils literal"><span class="pre">outputs</span></tt>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td>Using one of the available <tt class="docutils literal"><span class="pre">ZOO.formats</span></tt> you are also able to support various
<tt class="docutils literal"><span class="pre">ComplexData</span></tt> for both input and output of the service. To simplify the
presentation here, you will use only this default ones.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[5]</a></td><td>So in the hole you created in the previous section.</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table des Matières</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Documentation du Kernel ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/index.html">Documentation de services ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">ZOO API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2010/index.html">Workshop: Practical Introduction to ZOO: The Open WPS Platform</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Practical Introduction to ZOO-Project by playing with building blocks</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#foss4g-2012-prague">FOSS4G 2012 Prague</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sponsored-by">Sponsored By</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#special-thanks-to-our-knowledge-partners">Special thanks to our Knowledge Partners</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#workshop-table-of-content">WorkShop table of content</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="using_zoo_from_osgeolivevm.html">Configuration and ZOO-Kernel use</a></li>
<li class="toctree-l3"><a class="reference internal" href="first_service.html">Creating your first ZOO Service</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_blocks_presentation.html">Presenting building blocks - Using OGR based Web Services</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Playing with buildign blocks - Creating JavaScript Web Services</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2013/index.html">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Communauté ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/documentation.html">Guide de développement de la documentation</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<!-- Begin Footer -->
<div id="footer">
<div>

<div>
  <div class="menuContainer">
    <div class="menuItemList">
      <a href="../../index.html" shape="rect">Home</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">ZOO Project</a>

      <br/>
      <a href="/site/ZooWebSite/ZooProject/About" shape="rect">About</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Tribe" shape="rect">ZOO Tribe</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Events" shape="rect">Events</a>
      <br/>

      <a href="/site/ZooWebSite/ZooProject/Photos" shape="rect">Photos</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Contact" shape="rect">Contacts</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Components</a>

      <br/>
      <a href="/site/ZooWebSite/ZooKernel" shape="rect">ZOO Kernel</a>
      <br/>
      <a href="/site/ZooWebSite/ZooServices" shape="rect">ZOO Services</a>
      <br/>
      <a href="/site/ZooWebsite/ZooApi" shape="rect">ZOO API</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="../../dl/index.html" shape="rect">Download</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Docs</a>

      <br/>
      <a href="../../doc/en/index.html" shape="rect">English version</a>
      <br/>
      <a href="../../doc/fr/index.html" shape="rect">version française</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Demos</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/SpatialTools" shape="rect">ZOO Spatial Tools</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/WFS-T" shape="rect">ZOO Mapserver WFS-T</a>

      <br/>
      <a href="/site/ZooWebSite/Demo/GdalProfile" shape="rect">ZOO Elevation Profile</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/FormTools" shape="rect">ZOO Form tools</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="/trac" shape="rect">Trac</a>

      <br/>
    </div>
  </div>
  <br style="clear:both"/>
</div>
</div>
<p>
&copy; Copyright 2011 - <a class="ext-link" href="http://www.zoo-project.org" shape="rect"><span class="icon"> </span>ZOO Project</a> - All Rights Reserved. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.
</p>
</div>
<!-- End Footer -->
    
    <div class="footer">
    </div>

  </body>
</html>