<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Jouer avec les blocs de construction - Créer des Services Web JavaScript &mdash; ZOO Project 1.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="ZOO Project 1.3 documentation" href="../../index.html" />
    <link rel="up" title="ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting" href="index.html" />
    <link rel="next" title="Communauté ZOO" href="../../community/index.html" />
    <link rel="prev" title="Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting" href="building_blocks_presentation.html" />

<script type="text/javascript">
$(document).ready(function(){

	$("ul.topnav li a").hover(function() {

		//Following events are applied to the subnav itself (moving subnav up and down)
		$(this).parent().find("ul.subnav").slideDown('fast').show(); //Drop down the subnav on click

		$(this).parent().hover(function() {
		}, function(){
			$(this).parent().find("ul.subnav").slideUp('slow'); //When the mouse hovers out of the subnav, move it back up
		});

		//Following events are applied to the trigger (Hover events for the trigger)
		}).hover(function() {
			$(this).addClass("subhover"); //On hover over, add class "subhover"
		}, function(){	//On Hover Out
			$(this).removeClass("subhover"); //On hover out, remove class "subhover"
	});

});
</script>

     

  </head>
  <body>
<!-- Begin Header -->
<div id="wrapper">
  	<div id="myheader">
    	<div class="hleft">
    	  <h1 class="title">Open WPS Platform</h1>
    	</div>
    	<div class="hright">
    	</div>
  	</div>
</div>
<ul class="topnav">
  <li><a href="http://www.zoo-project.org/">Home</a></li>
  <li><a href="#">ZOO Project</a>
       <ul class="subnav">

         <li><a href="/site/ZooWebSite/ZooProject/About">About</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Tribe">ZOO Tribe</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Events">Events</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Photos">Photos</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Contact">Contacts</a></li>
       </ul>

  </li>
  <li>
    <a href="#">Components</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/ZooKernel">ZOO Kernel</a></li>
      <li><a href="/site/ZooWebSite/ZooServices">ZOO Services</a></li>
      <li><a href="/site/ZooWebsite/ZooApi">ZOO API</a></li>

    </ul>
  </li>
  <li><a href="/site/Downloads">Download</a></li>
  <li><a href="#">Docs</a>
    <ul class="subnav">
      <li><a href="../../../en/index.html">English</a></li>
      <li><a href="../../../fr/index.html">Français</a></li>
    </ul>
  </li>
  <li><a href="#">Demos</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/Demo/SpatialTools">ZOO Spatial Tools</a></li>

      <li><a href="/site/ZooWebSite/Demo/CGAL">ZOO CGAL Vor</a></li>
      <li><a href="/site/ZooWebSite/Demo/WFS-T">ZOO Mapserver WFS-T</a></li>
      <li><a href="/site/ZooWebSite/Demo/GdalProfile">ZOO Elevation Profile</a></li>
      <li><a href="/site/ZooWebSite/Demo/FormTools">ZOO Form tools</a></li>
    </ul>
  </li>
  <li><a href="/trac">Trac</a></li>
</ul>
<!-- End Header -->
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../community/index.html" title="Communauté ZOO"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="building_blocks_presentation.html" title="Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting"
             accesskey="P">précédent</a> |</li>
        <li><a href="../../index.html">ZOO Docs</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="playing-with-buildign-blocks-creating-javascript-web-services">
<span id="ogr-base-vect-ops"></span><h1><a class="toc-backref" href="#table-of-contents">Jouer avec les blocs de construction - Créer des Services Web JavaScript</a><a class="headerlink" href="#playing-with-buildign-blocks-creating-javascript-web-services" title="Lien permanent vers ce titre">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#playing-with-buildign-blocks-creating-javascript-web-services" id="id12">Jouer avec les blocs de construction - Créer des Services Web JavaScript</a><ul>
<li><a class="reference internal" href="#introduction" id="id13">Introduction</a></li>
<li><a class="reference internal" href="#zoo-api-overview" id="id14">Aperçu de la ZOO-API</a></li>
<li><a class="reference internal" href="#the-mask-service" id="id15">Le service Mask</a><ul>
<li><a class="reference internal" href="#the-zcfg" id="id16">Le ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-service" id="id17">Le service JavaScript</a></li>
<li><a class="reference internal" href="#publish-and-use-your-service" id="id18">Publier et utiliser votre service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#buffermask-service" id="id19">Service BufferMask</a><ul>
<li><a class="reference internal" href="#id6" id="id20">Le ZCFG</a></li>
<li><a class="reference internal" href="#id7" id="id21">Le service JavaScript</a></li>
<li><a class="reference internal" href="#id8" id="id22">Publier et utiliser votre service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bufferrequest-service" id="id23">Service BufferRequest</a><ul>
<li><a class="reference internal" href="#id10" id="id24">Le ZCFG</a></li>
<li><a class="reference internal" href="#the-javascript-code" id="id25">Le code JavaScript</a></li>
<li><a class="reference internal" href="#id11" id="id26">Publier et utiliser votre service</a></li>
</ul>
</li>
<li><a class="reference internal" href="#add-union-into-the-chain" id="id27">Ajouter Union dans la chaîne</a></li>
<li><a class="reference internal" href="#conclusion" id="id28">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Cette section illustre comment vous pouvez utiliser JavaScript côté serveur pour chaîner les services ensemble pour en construire de nouveaux. Vous allez créer un fournisseur de services ZOO utilisant les services que vous avez vu auparavant et le serveur WFS utilisant la ZOO-API. L&#8217;objectif final est d&#8217;interroger tous les POI inclus dans un tampon autour d&#8217;un objet et de les mettre en avant en utilisant un masque autour de ce tampon. La capture d&#8217;écran ci-dessous vous montre le résultat attendu:</p>
<a class="reference internal image-reference" href="../../_images/BufferMaskAndRequest_Level_151.png"><img alt="../../_images/BufferMaskAndRequest_Level_151.png" class="align-center" src="../../_images/BufferMaskAndRequest_Level_151.png" style="width: 650px;" /></a>
<p>Pour l&#8217;interface de routage, le résultat devrait ressembler à ceci:</p>
<a class="reference internal image-reference" href="../../_images/BufferMaskAndRequest_Routing_Level_15.png"><img alt="../../_images/BufferMaskAndRequest_Routing_Level_15.png" class="align-center" src="../../_images/BufferMaskAndRequest_Routing_Level_15.png" style="width: 650px;" /></a>
<p>Vous pouvez décomposer le résultat ci-dessus dans deux différents: le masque autour du tampon et les points inclus dans le tampon. Donc, vous allez créer deux services différents: l&#8217;un appelé <tt class="docutils literal"><span class="pre">BufferMask</span></tt> et l&#8217;autre appelée <tt class="docutils literal"><span class="pre">BufferRequest</span></tt>.</p>
<p>Mais avant d&#8217;implémenter tout service JavaScript, vous allez avoir un aperçu de la façon d&#8217;utiliser la ZOO API depuis votre installation ZOO-projet dans la section suivante.</p>
<p>Comme précédemment, vous créez en premier un nouveau répertoire pour stocker les fichiers de votre nouveau fournisseur de services:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">zoo</span><span class="o">-</span><span class="n">ws2013</span><span class="o">/</span><span class="n">jschains</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">env</span><span class="o">/</span>
</pre></div>
</div>
</div>
<div class="section" id="zoo-api-overview">
<h2><a class="toc-backref" href="#table-of-contents">Aperçu de la ZOO-API</a><a class="headerlink" href="#zoo-api-overview" title="Lien permanent vers ce titre">¶</a></h2>
<p>Le support JavaScript de la ZOO-API et du ZOO-Kernel vous rend capable d&#8217;exécuter des services implémentés en JavaScript côté serveur. Le JavaScript est un langage de programmation populaire, mais la plupart du temps utilisé côté client. Disons à partir d&#8217;un navigateur, mais ici c&#8217;est un peu différent.</p>
<p>Pour supporter le langage JavaScript, le ZOO-Kernel utilise l&#8217;API <a class="reference external" href="https://developer.mozilla.org/en/SpiderMonkey">SpiderMonkey</a> pour créer un environnement d&#8217;exécution javascript à partir duquel il va charger votre fichier JS puis extraire la fonction correspondante au service à exécuter à l&#8217;aide des paramètres pré-remplis. L&#8217;environnement d&#8217;exécution JavaScript créé par le ZOO-Kernel dépend de votre configuration. Si vous avez placé <tt class="docutils literal"><span class="pre">ZOO-api.js</span></tt> et <tt class="docutils literal"><span class="pre">ZOO-proj4js.js</span></tt> dans le même répertoire que votre ZOO-Kernel, cela signifie que votre environnement contient la ZOO-API et que Proj4js sera chargé avant votre service. Dans ce cas, vous pouvez accéder aux classes définies dans la ZOO-API JavaScript pour manipuler des données géographiques. Pour plus d&#8217;informations, merci de vous référer à la <a class="reference external" href="http://zoo-project.org/docs/api/index.html">Documentation de la ZOO-API</a>.</p>
<p>Même si elle peut être utile pour exécuter le JavaScript côté serveur, vous devriez vous rappeler que certaines fonctions de base JavaScript dont vous êtes familier n&#8217;existent pas ou ont un comportement différent. Par exemple, la simple fonction <tt class="docutils literal"><span class="pre">alert</span></tt> affichera des messages dans les journaux d&#8217;erreurs Apache plutôt que dans une fenêtre lorsqu&#8217;il est utilisé depuis un navigateur. La fonction <tt class="docutils literal"><span class="pre">alert</span></tt> peut être utilisée comme suit:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">alert</span><span class="p">(</span><span class="s">&quot;My alert message&quot;</span><span class="p">);</span>
</pre></div>
</div>
<p>Il n&#8217;y a pas de XMLHttpRequest disponible dans l&#8217;environnement JavaScript où votre service s&#8217;exécute. Heureusement, le ZOO-Kernel expose une fonction C au monde JavaScript nommée: <tt class="docutils literal"><span class="pre">JSRequest</span></tt>. Cette fonction vous rend capable depuis vos services JavaScript d&#8217;appeler d&#8217;autres services WPS (localement ou distants) ou d&#8217;autres types de services OGC tels que le WFS. Lorsque vous utilisez la ZOO-API, il est possible d&#8217;appeler des services en utilisant une instance <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt> <a class="footnote-reference" href="#f3" id="id1">[1]</a>, pour parser les réponses WPS utilisant <tt class="docutils literal"><span class="pre">ZOO.Format.WPS</span></tt> (cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html">ref</a>).</p>
<p>Quant aux services de Python que vous avez déjà vu dans les sections précédentes, les fonctions correspondantes à un service doivent prendre trois arguments: <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> et <tt class="docutils literal"><span class="pre">outputs</span></tt> <a class="footnote-reference" href="#f4" id="id2">[2]</a>. Néanmoins, comme le ZOO-Kernel n&#8217;est pas en mesure d&#8217;accéder aux valeurs modifiées <a class="footnote-reference" href="#f5" id="id3">[3]</a> par le code de service, plutôt que de retourner un entier comme en Python, ici vous devez retourner à la fois la valeur de nombre entier représentant le statut de votre service dans un objet JavaScript et les valeurs <tt class="docutils literal"><span class="pre">outputs</span></tt> résultantes comme un objet <a class="footnote-reference" href="#f6" id="id4">[4]</a>. Vous pouvez voir dans ce qui suit un exemple de code de service JavaScript:</p>
<div class="highlight-none"><div class="highlight"><pre>function SampleService(conf,inputs,outputs){
  var resultValue=someComputation(inputs);
  return
    {
        result: ZOO.SERVICE_SUCCEEDED,
        outputs: { &quot;Result&quot;: { &quot;mimeType&quot;: &quot;application/json&quot;, &quot;value&quot;: resultValue } }
    };
}
</pre></div>
</div>
<p>Avant de commencer à implémenter les services dont nous aurons besoin pour obtenir notre service BufferRequest final, commençons avec un plus simple.</p>
</div>
<div class="section" id="the-mask-service">
<h2><a class="toc-backref" href="#table-of-contents">Le service Mask</a><a class="headerlink" href="#the-mask-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette section, vous apprendrez comment créer votre premier service JavaScript qui renvoie simplement un masque rectangulaire autour d&#8217;un objet sélectionné. Pour construire ce masque, vous utiliserez le service Buffer pour créer une zone tampon assez grande autour d&#8217;une géométrie sélectionnée pour couvrir une part importante de votre carte. Vous pouvez voir le résultat attendu dans la capture d&#8217;écran suivante:</p>
<a class="reference internal image-reference" href="../../_images/Mask_Level_121.png"><img alt="../../_images/Mask_Level_121.png" class="align-center" src="../../_images/Mask_Level_121.png" style="width: 650px;" /></a>
<p>Comme précédemment, vous allez d&#8217;abord commencer en écrivant un ZCFG,  ensuite vous écrirez le code source JavaScript et finirez par publier votre fournisseur de services.</p>
<div class="section" id="the-zcfg">
<h3><a class="toc-backref" href="#table-of-contents">Le ZCFG</a><a class="headerlink" href="#the-zcfg" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ouvrez le fichier nommé <tt class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/Mask.zcfg</span></tt> avec votre éditeur de texte favori et ajoutez le contenu suivant:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[Mask]
 Title = Compute mask
 Abstract = Compute mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>Ici, vous définissez simplement une <tt class="docutils literal"><span class="pre">ComplexData``par</span> <span class="pre">défaut,</span> <span class="pre">à</span> <span class="pre">la</span> <span class="pre">fois</span> <span class="pre">pour</span> <span class="pre">``inputData</span></tt> et <tt class="docutils literal"><span class="pre">Result</span></tt>: un GML et un GeoJSON respectivement <a class="footnote-reference" href="#f7" id="id5">[5]</a>.</p>
</div>
<div class="section" id="the-javascript-service">
<h3><a class="toc-backref" href="#table-of-contents">Le service JavaScript</a><a class="headerlink" href="#the-javascript-service" title="Lien permanent vers ce titre">¶</a></h3>
<p>Comme vous aurez à interroger le service Buffer de nombreuses fois depuis votre service, vous devrez d&#8217;abord définir une fonction <tt class="docutils literal"><span class="pre">Buffer</span></tt> comme suit. Il utilise le <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt> pour interroger le service Buffer que vous avez vu dans la section précédente.</p>
<p>Ouvrez un fichier nommé <tt class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/foss4gws.js</span></tt> et ajoutez le contenu suivant:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">zoo_url</span><span class="o">=</span><span class="s1">&#39;http://localhost/cgi-bin/zoo_loader.cgi&#39;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mapfile</span><span class="o">=</span><span class="s2">&quot;/var/www/zoows2013-demo/map/w2013_1.map&quot;</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">mapserv_url</span><span class="o">=</span><span class="s2">&quot;http://localhost/cgi-bin/mapserv?map=&quot;</span><span class="o">+</span><span class="nx">mapfile</span><span class="p">;</span>

<span class="kd">function</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="nx">bDist</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">JSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fWPS</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">WPS</span><span class="p">();</span>

  <span class="c1">// Pass the value as json</span>
  <span class="kd">var</span> <span class="nx">myInputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">inputData</span><span class="p">),</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;BufferPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult</span><span class="o">=</span><span class="nx">myProcess</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs</span><span class="p">,</span><span class="nx">myOutputs</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">myExecuteResult</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Des lignes 12 à 15, vous donnez une chaîne GeoJSON (créé à partir de <tt class="docutils literal"><span class="pre">inputData</span></tt>) pour InputPolygon et, sur la ligne 14, vous définissez la valeur de BufferDistance à <tt class="docutils literal"><span class="pre">bDist</span></tt>. Sur la ligne 16, vous définissez Result comme un ResponseDocument, ainsi vous aurez à parser la réponse WPS utilisant le ZOO.Format.WPS, sur la ligne 21.</p>
<p>Sur la ligne 17, vous créez une instance <a class="reference external" href="http://zoo-project.org/docs/api/zoo-process.html#zoo-process">ZOO.Process</a> fournissant l&#8217;url  du ZOO-Kernel et le nom du service. Puis, à la ligne 18, vous exécutez les requêtes passant les entrées et sorties définies précédemment (des lignes 12 à 15).</p>
<p>Maintenant, vous avez votre fonction <tt class="docutils literal"><span class="pre">Buffer</span></tt>, il est temps de créer votre premier service JavaScript. Donc, éditer votre fichier <tt class="docutils literal"><span class="pre">foss4gws.js</span></tt> créé avant et ajoutez le contenu suivant:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">Mask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX and store its geometry in a ZOO.Feature</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>

  <span class="c1">// Return the created feature</span>
  <span class="k">return</span> <span class="p">{</span>
      <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
      <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="publish-and-use-your-service">
<h3><a class="toc-backref" href="#table-of-contents">Publier et utiliser votre service</a><a class="headerlink" href="#publish-and-use-your-service" title="Lien permanent vers ce titre">¶</a></h3>
<p>Maintenant vous avez à la fois votre ZCFG et votre code de service prêt, vous devez déployer votre nouveau fournisseur de services en utilisant la commande suivante:</p>
<div class="highlight-bash"><div class="highlight"><pre>cp ~/zoo-ws2013/jschains/cgi-env/* /usr/lib/cgi-bin
</pre></div>
</div>
<p>Maintenant, vous êtes prêt à utiliser votre service JavaScript en chargeant l`url &lt;<a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">http://localhost/zoows2013-demo/spatialtools.html</a>&gt;`__ suivante, cliquez sur une rue, puis cliquez sur le bouton &#8220;Mask&#8221;.</p>
</div>
</div>
<div class="section" id="buffermask-service">
<h2><a class="toc-backref" href="#table-of-contents">Service BufferMask</a><a class="headerlink" href="#buffermask-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette section, vous implémenterez un service simple JavaScript qui sera capable de créer un trou dans le masque que vous avez créé dans la <a class="reference external" href="#mask-service">section précédente</a>. Ce service sera utilisé pour mettre en évidence la zone tampon autour d&#8217;un objet sélectionné. Vous avez un aperçu du résultat attendu dans la capture d&#8217;écran suivante:</p>
<a class="reference internal image-reference" href="../../_images/BufferMask_Level_151.png"><img alt="../../_images/BufferMask_Level_151.png" class="align-center" src="../../_images/BufferMask_Level_151.png" style="width: 650px;" /></a>
<div class="section" id="id6">
<h3><a class="toc-backref" href="#table-of-contents">Le ZCFG</a><a class="headerlink" href="#id6" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ouvrez le fichier nommé <tt class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/BufferMask.zcfg</span></tt> avec votre éditeur de texte favori et copiez / collez le contenu suivant:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferMask]
 Title = Compute buffer mask
 Abstract = Compute buffer mask around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<p>Ce ZCFG est similaire au précédent. Merci de vous référer aux commentaires de la <a class="reference external" href="#the-zcfg">section précédente</a> pour plus d&#8217;informations.</p>
</div>
<div class="section" id="id7">
<h3><a class="toc-backref" href="#table-of-contents">Le service JavaScript</a><a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans ce service, vous utiliserez le même code source (jusqu&#8217;à la ligne 19) que vous avez utilisé dans la section précédente &lt;#the-javascript-service&gt;`__. En effet, vous devez calculer le masque (Mask) comme vous l&#8217;avez fait avant puis calculer le tampon (Buffer) pour créer un trou dans le masque (à la ligne 22) pour exécuter le service Difference (des lignes 25 à 40).</p>
<div class="highlight-guess"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49</pre></div></td><td class="code"><div class="highlight"><pre> <span class="kd">function</span> <span class="nx">BufferMask</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

   <span class="c1">// Create all required ZOO.formats</span>
   <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>

   <span class="c1">// Read the input GML</span>
   <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="cp">[</span><span class="s2">&quot;InputData&quot;</span><span class="cp">][</span><span class="s2">&quot;value&quot;</span><span class="cp">]</span><span class="p">);</span>

   <span class="c1">// Compute Buffer</span>
   <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.015</span><span class="p">);</span>

   <span class="c1">// Create the Buffer result BBOX</span>
   <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
   <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="p">.</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
   <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
     <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="cp">[</span><span class="nb">t</span><span class="cp">]</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="kd">var</span> <span class="nx">finalG</span><span class="o">=</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">toGeometry</span><span class="p">();</span>

  <span class="c1">// Compute Buffer standard buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Request Difference service using Buffer result and features in the BBOX</span>
  <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;DifferencePy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">finalG</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">},</span>
      <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
          <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
      <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span>  <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

   <span class="c1">// Return the bbox</span>
   <span class="kd">var</span> <span class="nx">result</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Feature</span><span class="p">(</span><span class="nx">finalG</span><span class="p">,{</span><span class="s2">&quot;name&quot;</span><span class="o">:</span> <span class="s2">&quot;Result1000&quot;</span><span class="p">});</span>
   <span class="k">return</span> <span class="p">{</span>
       <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
       <span class="nx">outputs</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;Result&quot;</span><span class="o">:</span> <span class="p">{</span><span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span> <span class="p">}</span> <span class="p">}</span>
   <span class="p">};</span>

 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="id8">
<h3><a class="toc-backref" href="#table-of-contents">Publier et utiliser votre service</a><a class="headerlink" href="#id8" title="Lien permanent vers ce titre">¶</a></h3>
<p>Maintenant, vous pouvez publier votre service comme vous l&#8217;avez fait <a class="reference external" href="#publish-your-service">avant</a>. Pour utiliser votre service, merci d&#8217;utiliser <a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">l&#8217;url</a> suivante.</p>
</div>
</div>
<div class="section" id="bufferrequest-service">
<h2><a class="toc-backref" href="#table-of-contents">Service BufferRequest</a><a class="headerlink" href="#bufferrequest-service" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette section, vous allez créer un nouveau service: <tt class="docutils literal"><span class="pre">BufferRequest</span></tt> qui interrogera les POIs inclus dans le tampon (Buffer) autour d&#8217;un objet sélectionné <a class="footnote-reference" href="#f8" id="id9">[6]</a>. Vous allez utiliser la couche <tt class="docutils literal"><span class="pre">poi</span></tt> servie comme WFS par votre installation locale de MapServer. Vous pouvez voir dans la capture d&#8217;écran suivante, le résultat attendu:</p>
<a class="reference internal image-reference" href="../../_images/BufferRequest_Level_151.png"><img alt="../../_images/BufferRequest_Level_151.png" class="align-center" src="../../_images/BufferRequest_Level_151.png" style="width: 650px;" /></a>
<div class="section" id="id10">
<h3><a class="toc-backref" href="#table-of-contents">Le ZCFG</a><a class="headerlink" href="#id10" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ouvrez le fichier nommé <tt class="docutils literal"><span class="pre">~/zoo-ws2013/jschains/cgi-env/BufferRequest.zcfg</span></tt> avec votre éditeur de texte favori et copiez / collez le contenu suivant:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre>[BufferRequest]
 Title = Compute buffer request
 Abstract = Compute buffer request around a geometry
 processVersion = 1
 storeSupported = true
 statusSupported = true
 serviceProvider = foss4gws.js
 serviceType = JS
 &lt;DataInputs&gt;
  [InputData]
   Title = The feature
   Abstract = The feature to run the service with
   minOccurs = 1
   maxOccurs = 1
   &lt;ComplexData&gt;
    &lt;Default&gt;
    mimeType = text/xml
    encoding = utf-8
    &lt;/Default&gt;
   &lt;/ComplexData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting feature
   Abstract = The feature created by the service.
   &lt;ComplexOutput&gt;
     &lt;Default&gt;
     mimeType = application/json
     &lt;/Default&gt;
   &lt;/ComplexOutput&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="the-javascript-code">
<h3><a class="toc-backref" href="#table-of-contents">Le code JavaScript</a><a class="headerlink" href="#the-javascript-code" title="Lien permanent vers ce titre">¶</a></h3>
<p>Comme dans le service précédent, vous allez calculer un tampon autour de l&#8217;objet en entrée. Mais ensuite vous allez interroger les POI disponibles dans l&#8217;étendue du tampon en utilisant une requête WFS pour les utiliser afin d&#8217;exécuter un service <tt class="docutils literal"><span class="pre">Intersection</span></tt> en utilisant le tampon initial. La requête WFS est utile pour limiter le nombre de points à utiliser quand vous interrogez le service <tt class="docutils literal"><span class="pre">Intersection</span></tt>.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">BufferRequest</span><span class="p">(</span><span class="nx">conf</span><span class="p">,</span><span class="nx">inputs</span><span class="p">,</span><span class="nx">outputs</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGML</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GML</span><span class="p">();</span>

  <span class="c1">// Read the input GML</span>
  <span class="kd">var</span> <span class="nx">inputData</span><span class="o">=</span><span class="nx">fGML</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">inputs</span><span class="p">[</span><span class="s2">&quot;InputData&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">]);</span>

  <span class="c1">// Compute Buffer</span>
  <span class="kd">var</span> <span class="nx">bufferResultAsJSON</span><span class="o">=</span><span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="mf">0.0015</span><span class="p">);</span>

  <span class="c1">// Create the Buffer result BBOX</span>
  <span class="kd">var</span> <span class="nx">bbox</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Bounds</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">bounds</span><span class="o">=</span><span class="nx">bufferResultAsJSON</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">geometry</span><span class="p">.</span><span class="nx">getVertices</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">t</span> <span class="k">in</span> <span class="nx">bounds</span><span class="p">){</span>
    <span class="nx">bbox</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">bounds</span><span class="p">[</span><span class="nx">t</span><span class="p">]);</span>
  <span class="p">}</span>

  <span class="c1">// Request Intersection service using Buffer result and WFS request using the</span>
  <span class="c1">// BBOX</span>
  <span class="kd">var</span> <span class="nx">myProcess2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;Intersection&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">req</span><span class="o">=</span><span class="s2">&quot;&amp;amp;version=1.0.0&amp;amp;request=GetFeature&amp;amp;typename=poi1&quot;</span><span class="p">;</span>
  <span class="nx">req</span><span class="o">+=</span><span class="s2">&quot;&amp;amp;SRS=EPSG:4326&amp;amp;BBOX=&quot;</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">myInputs2</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">InputEntity1</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">bufferResultAsJSON</span><span class="p">),</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span>
    <span class="p">},</span>
    <span class="nx">InputEntity2</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span>
      <span class="nx">xlink</span><span class="o">:</span> <span class="nx">mapserv_url</span><span class="o">+</span><span class="nx">req</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">left</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">bottom</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">right</span><span class="o">+</span><span class="s2">&quot;,&quot;</span><span class="o">+</span><span class="nx">bbox</span><span class="p">.</span><span class="nx">top</span><span class="p">,</span>
      <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;text/xml&quot;</span>
    <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs2</span><span class="o">=</span> <span class="p">{</span><span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult4</span><span class="o">=</span><span class="nx">myProcess2</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs2</span><span class="p">,</span><span class="nx">myOutputs2</span><span class="p">);</span>

  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">result</span><span class="o">:</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">SERVICE_SUCCEEDED</span><span class="p">,</span>
    <span class="nx">outputs</span><span class="o">:</span> <span class="p">[</span> <span class="p">{</span><span class="nx">name</span><span class="o">:</span><span class="s2">&quot;Result&quot;</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult4</span><span class="p">}</span> <span class="p">]</span>
  <span class="p">};</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">pour tirer avantage du système de cache du ZOO-Kernel, vous utilisez directement la requête WFS comme <tt class="docutils literal"><span class="pre">xlink:href</span></tt> plutôt que la valeur pour <tt class="docutils literal"><span class="pre">InputEntity2</span></tt> (des lignes 31 à 34) et utilisez le <tt class="docutils literal"><span class="pre">mimeType</span></tt> <tt class="docutils literal"><span class="pre">text/xml</span></tt> (à la ligne 40). En effet, la ZOO-API n&#8217;utilise pas les mécanismes de cache interne.</p>
</div>
</div>
<div class="section" id="id11">
<h3><a class="toc-backref" href="#table-of-contents">Publier et utiliser votre service</a><a class="headerlink" href="#id11" title="Lien permanent vers ce titre">¶</a></h3>
<p>Maintenant, vous pouvez publier votre service comme vous l&#8217;avez fait <a class="reference external" href="#publish-your-service">avant</a>. Pour utiliser votre service, merci d&#8217;utiliser <a class="reference external" href="http://localhost/zoows2013-demo/spatialtools.html">l&#8217;url</a> suivante.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vous pouvez cliquer sur &#8220;Buffer Request and Mask&#8221;  pour obtenir le même résultat que celui présenté dans <a class="reference external" href="#introduction">la capture d&#8217;écran initiale</a>.</p>
</div>
</div>
</div>
<div class="section" id="add-union-into-the-chain">
<h2><a class="toc-backref" href="#table-of-contents">Ajouter Union dans la chaîne</a><a class="headerlink" href="#add-union-into-the-chain" title="Lien permanent vers ce titre">¶</a></h2>
<p>Comme vous pouvez le voir dans la capture d&#8217;écran suivante, lors de l&#8217;utilisation du service Buffer en utilisant une collection d&#8217;objets contenant plus d&#8217;une géométrie, le résultat est composé de plusieurs géométries. Ainsi, l&#8217;exécution d&#8217;un service Buffer sur l&#8217;interface de routage se traduira par un tampon multiple:</p>
<a class="reference internal image-reference" href="../../_images/Buffer_Routing_Level_15.png"><img alt="../../_images/Buffer_Routing_Level_15.png" class="align-center" src="../../_images/Buffer_Routing_Level_15.png" style="width: 650px;" /></a>
<p>Donc, pour obtenir le même résultat que celui que vous avez obtenu lors de la sélection d&#8217;une seule route, vous devez utiliser une Union de géométrie (entrée ou celle retournée par le service <tt class="docutils literal"><span class="pre">Buffer</span></tt>). Comme vous utilisez la ZOO-API JavaScript, vous pouvez simplement mettre à jour la fonction JavaScript <tt class="docutils literal"><span class="pre">Buffer</span></tt> que vous avez défini plus tôt, pour appeler d&#8217;abord l&#8217;Union de chaque géométrie disponible, dans une collection d&#8217;objets avant d&#8217;interroger (ou après avoir interrogé) le service Buffer. Heureusement, il ya déjà ce service Python disponible, son nom est <tt class="docutils literal"><span class="pre">UnionOne1</span></tt>, ainsi vous avez juste besoin de l&#8217;ajouter dans votre chaîne de service.</p>
<p>Voici le code final pour la fonction JavaScript de Buffer:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">Buffer</span><span class="p">(</span><span class="nx">inputData</span><span class="p">,</span><span class="nx">bDist</span><span class="p">){</span>

  <span class="c1">// Create all required ZOO.formats</span>
  <span class="kd">var</span> <span class="nx">fJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">JSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fGJ</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">GeoJSON</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">fWPS</span><span class="o">=</span><span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Format</span><span class="p">.</span><span class="nx">WPS</span><span class="p">();</span>

  <span class="c1">// Call the UnionOne1 Service</span>
  <span class="kd">var</span> <span class="nx">myInputs0</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">inputData</span><span class="p">),</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs0</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess0</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;UnionOne1&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult0</span><span class="o">=</span><span class="nx">myProcess0</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs0</span><span class="p">,</span><span class="nx">myOutputs0</span><span class="p">);</span>

  <span class="c1">// Call the BufferPy Service</span>
  <span class="kd">var</span> <span class="nx">myInputs</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">InputPolygon</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;complex&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span> <span class="nx">myExecuteResult0</span><span class="p">,</span> <span class="nx">mimeType</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">},</span>
      <span class="nx">BufferDistance</span><span class="o">:</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;float&#39;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="o">:</span> <span class="nx">bDist</span> <span class="p">}</span>
  <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myOutputs</span><span class="o">=</span> <span class="p">{</span> <span class="nx">Result</span><span class="o">:</span> <span class="p">{</span> <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;RawDataOutput&#39;</span><span class="p">,</span> <span class="s2">&quot;mimeType&quot;</span><span class="o">:</span> <span class="s2">&quot;application/json&quot;</span> <span class="p">}</span> <span class="p">};</span>
  <span class="kd">var</span> <span class="nx">myProcess</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZOO</span><span class="p">.</span><span class="nx">Process</span><span class="p">(</span><span class="nx">zoo_url</span><span class="p">,</span><span class="s1">&#39;BufferPy&#39;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">myExecuteResult</span><span class="o">=</span><span class="nx">myProcess</span><span class="p">.</span><span class="nx">Execute</span><span class="p">(</span><span class="nx">myInputs</span><span class="p">,</span><span class="nx">myOutputs</span><span class="p">);</span>

  <span class="k">return</span> <span class="nx">fGJ</span><span class="p">.</span><span class="nx">read</span><span class="p">(</span><span class="nx">myExecuteResult</span><span class="p">);</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#table-of-contents">Conclusion</a><a class="headerlink" href="#conclusion" title="Lien permanent vers ce titre">¶</a></h2>
<p>Après avoir compris comment les services d&#8217;opérations géométriques basiques fonctionnent, ici vous allez construire étape par étape de nouveaux services JavaScript qui réutilisent les précédents et les combinent de différentes façons. Ceci a été réalisé en utilisant la ZOO-API, composée par des fonctions C exposés par le ZOO-Kernel à l&#8217;environnement des services d&#8217;exécution JavaScript et des fichiers JS qui peuvent être installés en option.</p>
<p class="rubric">Notes de pied de page</p>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><p class="first last">La classe <tt class="docutils literal"><span class="pre">ZOO.Process</span></tt> utilise <tt class="docutils literal"><span class="pre">JSRequest</span></tt> (cf. <a class="reference external" href="http://zoo-project.org/docs/api/zoo-format-wps.html">ref</a>). Vous aurez un exemple d&#8217;utilisation <a class="reference external" href="#the-javascript-service">plus tard</a>.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f4" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><p class="first last">Ainsi <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> et <tt class="docutils literal"><span class="pre">outputs</span></tt> sont de simples objets JavaScript, similaires aux dictionnaires Python utilisés dans la <a class="reference external" href="ogr_base_vect_ops.html">section précédente</a>.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><p class="first last">Comme <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> et <tt class="docutils literal"><span class="pre">outputs</span></tt>.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[4]</a></td><td><p class="first last">Vous pouvez également retourner un objet de configuration si vous obtenez des informations mises à jour depuis votre service JavaScript (tels que des cookies par exemple)</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f7" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id5">[5]</a></td><td><p class="first last">En utilisant un des <tt class="docutils literal"><span class="pre">ZOO.formats</span></tt> disponibles, vous êtes également capable de supporter divers <tt class="docutils literal"><span class="pre">ComplexData</span></tt> à la fois en entrée et en sortie du service. Pour simplifier la présentation ici, vous utiliserez seulement ceux par défaut.</p>
</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id9">[6]</a></td><td><p class="first last">Ainsi, dans le trou que vous avez créé dans la section précédente.</p>
</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table des Matières</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Documentation du Kernel ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/index.html">Documentation de services ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">ZOO API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2010/index.html">Workshop: Practical Introduction to ZOO: The Open WPS Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2012/index.html">Practical Introduction to ZOO-Project by playing with building blocks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#foss4g-2013-nottingham">FOSS4G 2013 Nottingham</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#foss4g-cee-2013-bucharest">FOSS4G-CEE 2013 Bucharest</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sponsored-by">Sponsorisé par</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#special-thanks-to-our-knowledge-partners">Merci à nos partenaires de connaissance</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#workshop-table-of-content">Tables des matières du workshop</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="using_zoo_from_osgeolivevm.html">Configuration et utilisation du ZOO-Kernel</a></li>
<li class="toctree-l3"><a class="reference internal" href="first_service.html">Créer votre premier service ZOO</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_blocks_presentation.html">Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Jouer avec les blocs de construction - Créer des Services Web JavaScript</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Communauté ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/documentation.html">Guide de développement de la documentation</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<!-- Begin Footer -->
<div id="footer">
<div>

<div>
  <div class="menuContainer">
    <div class="menuItemList">
      <a href="../../index.html" shape="rect">Home</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">ZOO Project</a>

      <br/>
      <a href="/site/ZooWebSite/ZooProject/About" shape="rect">About</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Tribe" shape="rect">ZOO Tribe</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Events" shape="rect">Events</a>
      <br/>

      <a href="/site/ZooWebSite/ZooProject/Photos" shape="rect">Photos</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Contact" shape="rect">Contacts</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Components</a>

      <br/>
      <a href="/site/ZooWebSite/ZooKernel" shape="rect">ZOO Kernel</a>
      <br/>
      <a href="/site/ZooWebSite/ZooServices" shape="rect">ZOO Services</a>
      <br/>
      <a href="/site/ZooWebsite/ZooApi" shape="rect">ZOO API</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="../../dl/index.html" shape="rect">Download</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Docs</a>

      <br/>
      <a href="../../doc/en/index.html" shape="rect">English version</a>
      <br/>
      <a href="../../doc/fr/index.html" shape="rect">version française</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Demos</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/SpatialTools" shape="rect">ZOO Spatial Tools</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/WFS-T" shape="rect">ZOO Mapserver WFS-T</a>

      <br/>
      <a href="/site/ZooWebSite/Demo/GdalProfile" shape="rect">ZOO Elevation Profile</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/FormTools" shape="rect">ZOO Form tools</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="/trac" shape="rect">Trac</a>

      <br/>
    </div>
  </div>
  <br style="clear:both"/>
</div>
</div>
<p>
&copy; Copyright 2011 - <a class="ext-link" href="http://www.zoo-project.org" shape="rect"><span class="icon"> </span>ZOO Project</a> - All Rights Reserved. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.
</p>
</div>
<!-- End Footer -->
    
    <div class="footer">
    </div>

  </body>
</html>