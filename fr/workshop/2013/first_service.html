<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Créer votre premier service ZOO &mdash; ZOO Project 1.3 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="top" title="ZOO Project 1.3 documentation" href="../../index.html" />
    <link rel="up" title="ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting" href="index.html" />
    <link rel="next" title="Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting" href="building_blocks_presentation.html" />
    <link rel="prev" title="Configuration et utilisation du ZOO-Kernel" href="using_zoo_from_osgeolivevm.html" />

<script type="text/javascript">
$(document).ready(function(){

	$("ul.topnav li a").hover(function() {

		//Following events are applied to the subnav itself (moving subnav up and down)
		$(this).parent().find("ul.subnav").slideDown('fast').show(); //Drop down the subnav on click

		$(this).parent().hover(function() {
		}, function(){
			$(this).parent().find("ul.subnav").slideUp('slow'); //When the mouse hovers out of the subnav, move it back up
		});

		//Following events are applied to the trigger (Hover events for the trigger)
		}).hover(function() {
			$(this).addClass("subhover"); //On hover over, add class "subhover"
		}, function(){	//On Hover Out
			$(this).removeClass("subhover"); //On hover out, remove class "subhover"
	});

});
</script>

     

  </head>
  <body>
<!-- Begin Header -->
<div id="wrapper">
  	<div id="myheader">
    	<div class="hleft">
    	  <h1 class="title">Open WPS Platform</h1>
    	</div>
    	<div class="hright">
    	</div>
  	</div>
</div>
<ul class="topnav">
  <li><a href="http://www.zoo-project.org/">Home</a></li>
  <li><a href="#">ZOO Project</a>
       <ul class="subnav">

         <li><a href="/site/ZooWebSite/ZooProject/About">About</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Tribe">ZOO Tribe</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Events">Events</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Photos">Photos</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Contact">Contacts</a></li>
       </ul>

  </li>
  <li>
    <a href="#">Components</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/ZooKernel">ZOO Kernel</a></li>
      <li><a href="/site/ZooWebSite/ZooServices">ZOO Services</a></li>
      <li><a href="/site/ZooWebsite/ZooApi">ZOO API</a></li>

    </ul>
  </li>
  <li><a href="/site/Downloads">Download</a></li>
  <li><a href="#">Docs</a>
    <ul class="subnav">
      <li><a href="../../../en/index.html">English</a></li>
      <li><a href="../../../fr/index.html">Français</a></li>
    </ul>
  </li>
  <li><a href="#">Demos</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/Demo/SpatialTools">ZOO Spatial Tools</a></li>

      <li><a href="/site/ZooWebSite/Demo/CGAL">ZOO CGAL Vor</a></li>
      <li><a href="/site/ZooWebSite/Demo/WFS-T">ZOO Mapserver WFS-T</a></li>
      <li><a href="/site/ZooWebSite/Demo/GdalProfile">ZOO Elevation Profile</a></li>
      <li><a href="/site/ZooWebSite/Demo/FormTools">ZOO Form tools</a></li>
    </ul>
  </li>
  <li><a href="/trac">Trac</a></li>
</ul>
<!-- End Header -->
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="building_blocks_presentation.html" title="Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="using_zoo_from_osgeolivevm.html" title="Configuration et utilisation du ZOO-Kernel"
             accesskey="P">précédent</a> |</li>
        <li><a href="../../index.html">ZOO Docs</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="creating-your-first-zoo-service">
<span id="first-service"></span><h1><a class="toc-backref" href="#table-of-contents">Créer votre premier service ZOO</a><a class="headerlink" href="#creating-your-first-zoo-service" title="Lien permanent vers ce titre">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table des matères</p>
<ul class="simple">
<li><a class="reference internal" href="#creating-your-first-zoo-service" id="id4">Créer votre premier service ZOO</a><ul>
<li><a class="reference internal" href="#introduction" id="id5">Introduction</a></li>
<li><a class="reference internal" href="#service-and-publication-process-overview" id="id6">Service et vue d&#8217;ensemble du processus de publication</a></li>
<li><a class="reference internal" href="#creating-your-first-zcfg-file" id="id7">Créez votre premier fichier ZCFG</a></li>
<li><a class="reference internal" href="#test-requests" id="id8">Tester les requêtes</a><ul>
<li><a class="reference internal" href="#test-the-getcapabilities-request" id="id9">Tester la requête GetCapabilities</a></li>
<li><a class="reference internal" href="#test-the-describeprocess-request" id="id10">Tester la requête DescribeProcess</a></li>
<li><a class="reference internal" href="#test-the-execute-request" id="id11">Tester la requête  Execute</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementing-the-python-service" id="id12">Implémentez le Service Python</a><ul>
<li><a class="reference internal" href="#general-principles" id="id13">Principes généraux</a></li>
<li><a class="reference internal" href="#the-hello-service" id="id14">Le Service Hello</a></li>
</ul>
</li>
<li><a class="reference internal" href="#interracting-with-your-service-using-execute-requests" id="id15">Interragir avec votre service en utilisant des requêtes Execute</a></li>
<li><a class="reference internal" href="#conclusion" id="id16">Conclusion</a></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2><a class="toc-backref" href="#table-of-contents">Introduction</a><a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette partie, vous allez créer et publier un service ZOO simple appelé <tt class="docutils literal"><span class="pre">Hello</span></tt> qui retournera simplement un message hello contenant la valeur d&#8217;entrée fournie. Il sera utile de présenter plus en détails le concept général sur la manière pour le ZOO-Kernel de fonctionner et traiter les demandes.</p>
</div>
<div class="section" id="service-and-publication-process-overview">
<h2><a class="toc-backref" href="#table-of-contents">Service et vue d&#8217;ensemble du processus de publication</a><a class="headerlink" href="#service-and-publication-process-overview" title="Lien permanent vers ce titre">¶</a></h2>
<p>Avant de commencer à développer un service ZOO, vous devriez vous rappeler que dans le ZOO-projet, un service est un couple composé de:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">un fichier de métadonnées: un fichier de configuration de service ZOO (ZCFG) contenant des informations de métadonnées sur un service (fournissant des informations sur les entrées et sorties par défaut / supportées pour un service)</p>
</li>
<li><p class="first">un fournisseur de services: il dépend du langage de programmation utilisé, mais pour Python c&#8217;est un module et pour JavaScript un fichier de script.</p>
</li>
</ul>
</div></blockquote>
<p>Pour publier votre service, ce qui signifie rendre votre Kernel ZOO conscient de sa présence, vous devez copier un fichier ZCFG dans le répertoire où <tt class="docutils literal"><span class="pre">zoo_loader.cgi</span></tt> est situé (dans ce workshop, <tt class="docutils literal"><span class="pre">/usr/lib/cgi-bin</span></tt>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">seul le fichier ZCFG est requis pour le service pour être considéré comme disponible. Donc, si vous n&#8217;avez pas le fournisseur de services, évidemment, votre requête Execute échouera comme nous le verrons plus tard.</p>
</div>
<p>Avant la publication, vous devriez stocker votre travail en cours, ainsi, vous aurez donc commencer par créer un répertoire pour stocker les fichiers de votre fournisseur de services:</p>
<div class="highlight-none"><div class="highlight"><pre>mkdir -p /home/user/zoo-ws2013/ws_sp/cgi-env
</pre></div>
</div>
<p>Une fois que le ZCFG et le module Python sont tous deux prêts, vous pouvez publier simplement en copiant les fichiers correspondants dans le même répertoire que le ZOO-Kernel.</p>
</div>
<div class="section" id="creating-your-first-zcfg-file">
<h2><a class="toc-backref" href="#table-of-contents">Créez votre premier fichier ZCFG</a><a class="headerlink" href="#creating-your-first-zcfg-file" title="Lien permanent vers ce titre">¶</a></h2>
<p>Vous allez commencer par créer le fichier ZCFG pour le service <tt class="docutils literal"><span class="pre">Hello</span></tt>. Modifier le fichier <tt class="docutils literal"><span class="pre">/home/user/zoo-ws2013/ws_sp/cgi-env/Hello.zcfg</span></tt> et ajouter le contenu suivant:</p>
<div class="highlight-none"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre>[Hello]
 Title = Return a hello message.
 Abstract = Create a welcome string.
 processVersion = 2
 storeSupported = true
 statusSupported = true
 serviceProvider = test_service
 serviceType = Python
 &lt;DataInputs&gt;
  [name]
   Title = Input string
   Abstract = The string to insert in the hello message.
   minOccurs = 1
   maxOccurs = 1
   &lt;LiteralData&gt;
       dataType = string
       &lt;Default /&gt;
   &lt;/LiteralData&gt;
 &lt;/DataInputs&gt;
 &lt;DataOutputs&gt;
  [Result]
   Title = The resulting string
   Abstract = The hello message containing the input string
   &lt;LiteralData&gt;
       dataType = string
       &lt;Default /&gt;
   &lt;/LiteralData&gt;
 &lt;/DataOutputs&gt;
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">le nom du fichier ZCFG et le nom entre crochets (ici <tt class="docutils literal"><span class="pre">[Hello]</span></tt>) doivent être les mêmes et correspondre au nom de la fonction que vous allez définir dans votre fournisseur de services.</p>
</div>
<p>Comme vous pouvez le voir dans le fichier de configuration du service ZOO présenté ci-dessus, il est divisé en trois sections distinctes:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p class="first">Information de métadonnée principale (de la ligne 2 à 8)</p>
</li>
<li><p class="first">Liste des Informations de métadonnée en entrée (de la ligne 9 à 19)</p>
</li>
<li><p class="first">Liste des Informations de métadonnée en sortie (de la ligne 20 à 28)</p>
</li>
</ol>
</div></blockquote>
<p>Vous pouvez obtenir plus d&#8217;informations sur le ZCFG depuis <a class="reference external" href="http://zoo-project.org/docs/services/zcfg-reference.html">la documentation de référence</a>.</p>
<p>Si vous copiez le fichier <tt class="docutils literal"><span class="pre">Hello.zcfg</span></tt> dans le même répertoire que votre Kernel ZOO alors vous serez en mesure d&#8217;interroger DescribeProcess en utilisant l&#8217;<tt class="docutils literal"><span class="pre">Identifier</span></tt> de <tt class="docutils literal"><span class="pre">Hello</span></tt>. Le service <tt class="docutils literal"><span class="pre">Hello</span></tt> devrait également être listé dans le document de &#8220;Capabilities&#8221;.</p>
</div>
<div class="section" id="test-requests">
<h2><a class="toc-backref" href="#table-of-contents">Tester les requêtes</a><a class="headerlink" href="#test-requests" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans cette section, vous testerez chaque requête WPS: GetCapabilities, DescribeProcess et Execute. Notez que seuls les GetCapabilities et DescribeProcess devraient fonctionner à cette étape.</p>
<div class="section" id="test-the-getcapabilities-request">
<h3><a class="toc-backref" href="#table-of-contents">Tester la requête GetCapabilities</a><a class="headerlink" href="#test-the-getcapabilities-request" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous lancez la requête <tt class="docutils literal"><span class="pre">GetCapabilities</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=GetCapabilities&amp;service=WPS
</pre></div>
</div>
<p>Maintenant, vous devriez trouver votre service dans un noeud <tt class="docutils literal"><span class="pre">Process</span></tt> dans <tt class="docutils literal"><span class="pre">ProcessOfferings</span></tt>:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;wps:Process</span> <span class="na">wps:processVersion=</span><span class="s">&quot;2&quot;</span><span class="nt">&gt;</span>
 <span class="nt">&lt;ows:Identifier&gt;</span>Hello<span class="nt">&lt;/ows:Identifier&gt;</span>
 <span class="nt">&lt;ows:Title&gt;</span>Return a hello message.<span class="nt">&lt;/ows:Title&gt;</span>
 <span class="nt">&lt;ows:Abstract&gt;</span>Create a welcome string.<span class="nt">&lt;/ows:Abstract&gt;</span>
<span class="nt">&lt;/wps:Process&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="test-the-describeprocess-request">
<h3><a class="toc-backref" href="#table-of-contents">Tester la requête DescribeProcess</a><a class="headerlink" href="#test-the-describeprocess-request" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez accéder à <tt class="docutils literal"><span class="pre">ProcessDescription</span></tt> du service <tt class="docutils literal"><span class="pre">Hello</span></tt> en utilisant la requête <tt class="docutils literal"><span class="pre">DescribeProcess</span></tt> suivante:</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=DescribeProcess&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello
</pre></div>
</div>
<p>Vous devriez avoir la réponse suivante:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;wps:ProcessDescriptions</span> <span class="na">xmlns:ows=</span><span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span> <span class="na">xmlns:wps=</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0&quot;</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/wps/1.0.0 http://schemas.opengis.net/wps/1.0.0/wpsDescribeProcess_response.xsd&quot;</span> <span class="na">service=</span><span class="s">&quot;WPS&quot;</span> <span class="na">version=</span><span class="s">&quot;1.0.0&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en-US&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ProcessDescription</span> <span class="na">wps:processVersion=</span><span class="s">&quot;2&quot;</span> <span class="na">storeSupported=</span><span class="s">&quot;true&quot;</span> <span class="na">statusSupported=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ows:Identifier&gt;</span>Hello<span class="nt">&lt;/ows:Identifier&gt;</span>
    <span class="nt">&lt;ows:Title&gt;</span>Return a hello message.<span class="nt">&lt;/ows:Title&gt;</span>
    <span class="nt">&lt;ows:Abstract&gt;</span>Create a welcome string.<span class="nt">&lt;/ows:Abstract&gt;</span>
    <span class="nt">&lt;DataInputs&gt;</span>
      <span class="nt">&lt;Input</span> <span class="na">minOccurs=</span><span class="s">&quot;1&quot;</span> <span class="na">maxOccurs=</span><span class="s">&quot;1&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ows:Identifier&gt;</span>name<span class="nt">&lt;/ows:Identifier&gt;</span>
        <span class="nt">&lt;ows:Title&gt;</span>Input string<span class="nt">&lt;/ows:Title&gt;</span>
        <span class="nt">&lt;ows:Abstract&gt;</span>The string to insert in the hello message.<span class="nt">&lt;/ows:Abstract&gt;</span>
        <span class="nt">&lt;LiteralData&gt;</span>
          <span class="nt">&lt;ows:DataType</span> <span class="na">ows:reference=</span><span class="s">&quot;http://www.w3.org/TR/xmlschema-2/#string&quot;</span><span class="nt">&gt;</span>string<span class="nt">&lt;/ows:DataType&gt;</span>
          <span class="nt">&lt;ows:AnyValue/&gt;</span>
        <span class="nt">&lt;/LiteralData&gt;</span>
      <span class="nt">&lt;/Input&gt;</span>
    <span class="nt">&lt;/DataInputs&gt;</span>
    <span class="nt">&lt;ProcessOutputs&gt;</span>
      <span class="nt">&lt;Output&gt;</span>
        <span class="nt">&lt;ows:Identifier&gt;</span>Result<span class="nt">&lt;/ows:Identifier&gt;</span>
        <span class="nt">&lt;ows:Title&gt;</span>The resulting string<span class="nt">&lt;/ows:Title&gt;</span>
        <span class="nt">&lt;ows:Abstract&gt;</span>The hello message containing the input string<span class="nt">&lt;/ows:Abstract&gt;</span>
        <span class="nt">&lt;LiteralOutput&gt;</span>
          <span class="nt">&lt;ows:DataType</span> <span class="na">ows:reference=</span><span class="s">&quot;http://www.w3.org/TR/xmlschema-2/#string&quot;</span><span class="nt">&gt;</span>string<span class="nt">&lt;/ows:DataType&gt;</span>
        <span class="nt">&lt;/LiteralOutput&gt;</span>
      <span class="nt">&lt;/Output&gt;</span>
    <span class="nt">&lt;/ProcessOutputs&gt;</span>
  <span class="nt">&lt;/ProcessDescription&gt;</span>
<span class="nt">&lt;/wps:ProcessDescriptions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="test-the-execute-request">
<h3><a class="toc-backref" href="#table-of-contents">Tester la requête  Execute</a><a class="headerlink" href="#test-the-execute-request" title="Lien permanent vers ce titre">¶</a></h3>
<p>Évidemment, vous ne pouvez pas exécuter votre service car le fichier Python n&#8217;a pas encore été publié. Si vous essayez la requête <tt class="docutils literal"><span class="pre">Execute</span></tt> suivante:</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto
</pre></div>
</div>
<p>Vous devriez obtenir un ExceptionReport similaire à celui fournit par la suite, ce qui est un comportement normal:</p>
<div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;ows:ExceptionReport</span> <span class="na">xmlns:ows=</span><span class="s">&quot;http://www.opengis.net/ows/1.1&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="na">xmlns:xlink=</span><span class="s">&quot;http://www.w3.org/1999/xlink&quot;</span> <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://www.opengis.net/ows/1.1 http://schemas.opengis.net/ows/1.1.0/owsExceptionReport.xsd&quot;</span> <span class="na">xml:lang=</span><span class="s">&quot;en-US&quot;</span> <span class="na">version=</span><span class="s">&quot;1.1.0&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;ows:Exception</span> <span class="na">exceptionCode=</span><span class="s">&quot;NoApplicableCode&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ows:ExceptionText&gt;</span>Python module test_service cannot be loaded.<span class="nt">&lt;/ows:ExceptionText&gt;</span>
  <span class="nt">&lt;/ows:Exception&gt;</span>
<span class="nt">&lt;/ows:ExceptionReport&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementing-the-python-service">
<h2><a class="toc-backref" href="#table-of-contents">Implémentez le Service Python</a><a class="headerlink" href="#implementing-the-python-service" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="general-principles">
<h3><a class="toc-backref" href="#table-of-contents">Principes généraux</a><a class="headerlink" href="#general-principles" title="Lien permanent vers ce titre">¶</a></h3>
<p>La chose la plus importante que vous devez savoir quand vous implémentez un nouveau ZOO-Services en utilisant le langage Python est que la fonction correspondant à votre service retourne une valeur entière qui représente l&#8217;état d&#8217;exécution (<tt class="docutils literal"><span class="pre">SERVICE_FAILED</span></tt> <a class="footnote-reference" href="#f1" id="id1">[1]</a> ou <tt class="docutils literal"><span class="pre">SERVICE_SUCCEEDED</span></tt> <a class="footnote-reference" href="#f2" id="id2">[2]</a>) et prend trois arguments (<a class="reference external" href="http://docs.python.org/tutorial/datastructures.html#dictionaries">dictionnaires Python</a>):</p>
<blockquote>
<div><ul class="simple">
<li><p class="first"><tt class="docutils literal"><span class="pre">conf</span></tt> : la configuration de l&#8217;environnement principal (correspondant au contenu de main.cfg)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">inputs</span></tt> : les entrées demandées / par défaut (utilisées pour accéder aux valeurs d&#8217;entrée)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">outputs</span></tt> : les sorties demandées / par défaut (utilisées pour stocker le résultat de traitement)</p>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">quand votre service retourne <tt class="docutils literal"><span class="pre">SERVICE_FAILED</span></tt> vous pouvez définir <tt class="docutils literal"><span class="pre">conf[&quot;lenv&quot;][&quot;message&quot;]</span></tt> pour ajouter un message personnalisé dans l&#8217;ExceptionReport retourné par le Kernel ZOO dans ce cas.</p>
</div>
<p>Vous obtenez dans ce qui suit une valeur <tt class="docutils literal"><span class="pre">conf</span></tt> exemple basée sur le fichier <tt class="docutils literal"><span class="pre">main.cfg</span></tt> que vous avez vu <a class="reference external" href="using_zoo_from_osgeolivevm.html#zoo-kernel-configuration">avant</a>.</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;main&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">language</span><span class="o">:</span> <span class="s2">&quot;en-US&quot;</span><span class="p">,</span>
    <span class="nx">lang</span><span class="o">:</span> <span class="s2">&quot;fr-FR,ja-JP&quot;</span><span class="p">,</span>
    <span class="nx">version</span><span class="o">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
    <span class="nx">encoding</span><span class="o">:</span> <span class="s2">&quot;utf-8&quot;</span><span class="p">,</span>
    <span class="nx">serverAddress</span><span class="o">:</span> <span class="s2">&quot;http://localhost/cgi-bin/zoo_loader.cgi&quot;</span><span class="p">,</span>
    <span class="nx">dataPath</span><span class="o">:</span> <span class="s2">&quot;/var/www/zoows-demo/map/data&quot;</span><span class="p">,</span>
    <span class="nx">tmpPath</span><span class="o">:</span> <span class="s2">&quot;/var/www/temp&quot;</span><span class="p">,</span>
    <span class="nx">tmpUrl</span><span class="o">:</span> <span class="s2">&quot;../temp&quot;</span><span class="p">,</span>
    <span class="nx">cacheDir</span><span class="o">:</span> <span class="s2">&quot;/var/www/temp/&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;identification&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">title</span><span class="o">:</span> <span class="s2">&quot;The ZOO-Project WPS Server FOSS4G 2013 Nottingham Workshop&quot;</span><span class="p">,</span>
    <span class="nx">keywords</span><span class="o">:</span> <span class="s2">&quot;WPS,GIS,buffer&quot;</span><span class="p">,</span>
    <span class="kr">abstract</span><span class="o">:</span> <span class="s2">&quot;Demo version of Zoo-Project for OSGeoLiveDVD 2013. See http://www.zoo-project.org&quot;</span><span class="p">,</span>
    <span class="nx">accessConstraints</span><span class="o">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="nx">fees</span><span class="o">:</span> <span class="s2">&quot;None&quot;</span>
  <span class="p">},</span>
  <span class="s2">&quot;provider&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="nx">positionName</span><span class="o">:</span> <span class="s2">&quot;Developer&quot;</span><span class="p">,</span>
    <span class="nx">providerName</span><span class="o">:</span> <span class="s2">&quot;ZOO-Project&quot;</span><span class="p">,</span>
    <span class="nx">addressAdministrativeArea</span><span class="o">:</span> <span class="s2">&quot;Lattes&quot;</span><span class="p">,</span>
    <span class="nx">addressCountry</span><span class="o">:</span> <span class="s2">&quot;fr&quot;</span><span class="p">,</span>
    <span class="nx">phoneVoice</span><span class="o">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
    <span class="nx">addressPostalCode</span><span class="o">:</span> <span class="s2">&quot;34970&quot;</span><span class="p">,</span>
    <span class="nx">role</span><span class="o">:</span> <span class="s2">&quot;Dev&quot;</span><span class="p">,</span>
    <span class="nx">providerSite</span><span class="o">:</span> <span class="s2">&quot;http://www.zoo-project.org&quot;</span><span class="p">,</span>
    <span class="nx">phoneFacsimile</span><span class="o">:</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span>
    <span class="nx">addressElectronicMailAddress</span><span class="o">:</span> <span class="s2">&quot;gerald.fenoy@geolabs.fr&quot;</span><span class="p">,</span>
    <span class="nx">addressCity</span><span class="o">:</span> <span class="s2">&quot;Denver&quot;</span><span class="p">,</span>
    <span class="nx">individualName</span><span class="o">:</span> <span class="s2">&quot;Gérald FENOY&quot;</span>
  <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Dans ce qui suit, vous obtenez une valeur de sortie exemple passée à un service Python ou JavaScript:</p>
<div class="highlight-javascript"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="s1">&#39;Result&#39;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s1">&#39;mimeType&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;inRequest&#39;</span><span class="o">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
    <span class="s1">&#39;encoding&#39;</span><span class="o">:</span> <span class="s1">&#39;UTF-8&#39;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">la valeur <tt class="docutils literal"><span class="pre">inRequest</span></tt> est définie en interne par le ZOO-Kernel et peut être utilisée pour déterminer depuis le service si la clé a été fournie dans la requête.</p>
</div>
<p>Le ZOO-projet fournit une ZOO-API qui était à l&#8217;origine uniquement disponible pour les services de JavaScript, mais grâce au travail de la communauté ZOO-projet, maintenant vous avez aussi accès à une ZOO-API utilisant le langage Python. Grâce à la ZOO-API Python, vous n&#8217;avez plus à retenir la valeur de SERVICE_SUCCEDED et SERVICE_FAILED, vous avez la capacité de traduire n&#8217;importe quelle chaîne depuis votre service Python en appelant la fonction <tt class="docutils literal"><span class="pre">_</span></tt> (ex: <tt class="docutils literal"><span class="pre">zoo._('Ma</span> <span class="pre">chaine</span> <span class="pre">a</span> <span class="pre">traduire')</span></tt>) ou de mettre à jour le statut actuel d&#8217;un service en cours d&#8217;exécution, en utilisant la fonction <tt class="docutils literal"><span class="pre">update_status</span></tt> de la même manière que vous l&#8217;utilisez depuis des services C ou JavaScript.</p>
</div>
<div class="section" id="the-hello-service">
<h3><a class="toc-backref" href="#table-of-contents">Le Service Hello</a><a class="headerlink" href="#the-hello-service" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez copier et coller ce qui suit dans le fichier <tt class="docutils literal"><span class="pre">/home/user/zoo-ws2013/ws_sp/cgi-env/test_service.py</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">zoo</span>
<span class="k">def</span> <span class="nf">Hello</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">inputs</span><span class="p">,</span><span class="n">outputs</span><span class="p">):</span>
    <span class="n">outputs</span><span class="p">[</span><span class="s">&quot;Result&quot;</span><span class="p">][</span><span class="s">&quot;value&quot;</span><span class="p">]</span><span class="o">=</span>\
            <span class="s">&quot;Hello &quot;</span><span class="o">+</span><span class="n">inputs</span><span class="p">[</span><span class="s">&quot;name&quot;</span><span class="p">][</span><span class="s">&quot;value&quot;</span><span class="p">]</span><span class="o">+</span><span class="s">&quot; from the ZOO-Project Python world !&quot;</span>
    <span class="k">return</span> <span class="n">zoo</span><span class="o">.</span><span class="n">SERVICE_SUCCEEDED</span>
</pre></div>
</div>
<p>Une fois que vous aurez fini l&#8217;édition du fichier, vous devriez le copier dans le répertoire <tt class="docutils literal"><span class="pre">/usr/lib/cgi-bin</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre>sudo cp /home/user/zoo-ws2013/ws_sp/cgi-env/* /usr/lib/cgi-bin
</pre></div>
</div>
</div>
</div>
<div class="section" id="interracting-with-your-service-using-execute-requests">
<h2><a class="toc-backref" href="#table-of-contents">Interragir avec votre service en utilisant des requêtes Execute</a><a class="headerlink" href="#interracting-with-your-service-using-execute-requests" title="Lien permanent vers ce titre">¶</a></h2>
<p>Maintenant, vous pouvez interroger Execute en utilisant l&#8217;url de base suivante:</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto
</pre></div>
</div>
<p>Vous pouvez interroger le serveur WPS pour retourner une réponse WPS XML contenant le résultat de votre calcul, demandant ResponseDocument ou vous pouvez accéder aux données directement depuis RawDataOutput.</p>
<ul class="simple">
<li><p class="first">Requête example utilisant le paramètre RawDataOutput:</p>
</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto&amp;RawDataOutput=Result
</pre></div>
</div>
<ul class="simple">
<li><p class="first">Requête example utilisant le paramètre par défaut ResponseDocument:</p>
</li>
</ul>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto&amp;ResponseDocument=Result
</pre></div>
</div>
<p>Lorsque vous utilisez ResponseDocument, il y a un attribut spécifique que vous pouvez utiliser pour demander au Kernel ZOO de stocker le résultat: <tt class="docutils literal"><span class="pre">asReference</span></tt>. Vous pouvez utiliser l&#8217;exemple suivant:</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto&amp;ResponseDocument=Result@asReference=true
</pre></div>
</div>
<p>Lorsque le traitement prend du temps, le client doit demander l&#8217;exécution d&#8217;un service en mettant à la fois les paramètres <tt class="docutils literal"><span class="pre">storeExecuteResponse</span></tt> et <tt class="docutils literal"><span class="pre">status</span></tt> à true pour forcer une exécution asynchrone. Cela fera retourner au ZOO-Kernel, sans attendre l&#8217;achèvement de l&#8217;exécution du service, mais après le début d&#8217;un autre processus ZOO-Kernel responsable de l&#8217;exécution du service, un ResponseDocument contenant un attribut <tt class="docutils literal"><span class="pre">statusLocation</span></tt> qui peut être utilisé pour accéder au statut d&#8217;un service en cours ou le résultat lorsque le processus a pris fin [# f3] _.</p>
<div class="highlight-none"><div class="highlight"><pre>http://localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=Hello&amp;DataInputs=name=toto&amp;ResponseDocument=Result&amp;storeExecuteResponse=true&amp;status=true
</pre></div>
</div>
</div>
<div class="section" id="conclusion">
<h2><a class="toc-backref" href="#table-of-contents">Conclusion</a><a class="headerlink" href="#conclusion" title="Lien permanent vers ce titre">¶</a></h2>
<p>Même si ce premier service était vraiment simple, il était utile pour illustrer comment le ZOO-Kernel remplit les paramètres <tt class="docutils literal"><span class="pre">conf</span></tt>, <tt class="docutils literal"><span class="pre">inputs</span></tt> et <tt class="docutils literal"><span class="pre">outputs</span></tt> avant pour charger et exécuter votre service de fonction, comment écrire un fichier ZCFG, comment publier un fournisseur de services en plaçant le ZCFG et les fichiers Python dans le même répertoire que le ZOO-Kernel, ensuite comment interragir avec votre service en utilisant à la fois les requêtes <tt class="docutils literal"><span class="pre">DescribeProcess</span></tt> et <tt class="docutils literal"><span class="pre">Execute</span></tt>. Nous verrons dans la <a class="reference external" href="building_blocks_presentation.html">section suivante</a> comment écrire des requêtes similaires en utilisant la syntaxe XML.</p>
<p class="rubric">Notes de pied de page</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td><tt class="docutils literal"><span class="pre">SERVICE_FAILED=4</span></tt></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td><tt class="docutils literal"><span class="pre">SERVICE_SUCCEEDED=3</span></tt></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="f3" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[3]</a></td><td><p class="first last">Pour obtenir l&#8217;url de statut en cours dans <tt class="docutils literal"><span class="pre">statusLocation</span></tt>, vous aurez besoin d&#8217;installer le service <a class="reference external" href="http://www.zoo-project.org/trac/browser/trunk/zoo-project/zoo-services/utils/status">utils/status</a>. Si vous n&#8217;avez pas ce service disponible, le ZOO-Kernel donnera simplement l&#8217;URL d&#8217;un fichier XML plat stockée sur le serveur qui contiendra, à la fin de l&#8217;exécution, le résultat de l&#8217;exécution du service.</p>
</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table des Matières</a></h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Documentation du Kernel ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/index.html">Documentation de services ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">ZOO API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2010/index.html">Workshop: Practical Introduction to ZOO: The Open WPS Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../2012/index.html">Practical Introduction to ZOO-Project by playing with building blocks</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="index.html#foss4g-2013-nottingham">FOSS4G 2013 Nottingham</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#foss4g-cee-2013-bucharest">FOSS4G-CEE 2013 Bucharest</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#sponsored-by">Sponsorisé par</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#special-thanks-to-our-knowledge-partners">Merci à nos partenaires de connaissance</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html#workshop-table-of-content">Tables des matières du workshop</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="using_zoo_from_osgeolivevm.html">Configuration et utilisation du ZOO-Kernel</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">Créer votre premier service ZOO</a></li>
<li class="toctree-l3"><a class="reference internal" href="building_blocks_presentation.html">Présentation des blocs de construction - Utiliser des Services Web basés sur OGR et PgRouting</a></li>
<li class="toctree-l3"><a class="reference internal" href="js_services_chaining.html">Jouer avec les blocs de construction - Créer des Services Web JavaScript</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../community/index.html">Communauté ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../development/documentation.html">Guide de développement de la documentation</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<!-- Begin Footer -->
<div id="footer">
<div>

<div>
  <div class="menuContainer">
    <div class="menuItemList">
      <a href="../../index.html" shape="rect">Home</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">ZOO Project</a>

      <br/>
      <a href="/site/ZooWebSite/ZooProject/About" shape="rect">About</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Tribe" shape="rect">ZOO Tribe</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Events" shape="rect">Events</a>
      <br/>

      <a href="/site/ZooWebSite/ZooProject/Photos" shape="rect">Photos</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Contact" shape="rect">Contacts</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Components</a>

      <br/>
      <a href="/site/ZooWebSite/ZooKernel" shape="rect">ZOO Kernel</a>
      <br/>
      <a href="/site/ZooWebSite/ZooServices" shape="rect">ZOO Services</a>
      <br/>
      <a href="/site/ZooWebsite/ZooApi" shape="rect">ZOO API</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="../../dl/index.html" shape="rect">Download</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Docs</a>

      <br/>
      <a href="../../doc/en/index.html" shape="rect">English version</a>
      <br/>
      <a href="../../doc/fr/index.html" shape="rect">version française</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Demos</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/SpatialTools" shape="rect">ZOO Spatial Tools</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/WFS-T" shape="rect">ZOO Mapserver WFS-T</a>

      <br/>
      <a href="/site/ZooWebSite/Demo/GdalProfile" shape="rect">ZOO Elevation Profile</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/FormTools" shape="rect">ZOO Form tools</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="/trac" shape="rect">Trac</a>

      <br/>
    </div>
  </div>
  <br style="clear:both"/>
</div>
</div>
<p>
&copy; Copyright 2011 - <a class="ext-link" href="http://www.zoo-project.org" shape="rect"><span class="icon"> </span>ZOO Project</a> - All Rights Reserved. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.
</p>
</div>
<!-- End Footer -->
    
    <div class="footer">
    </div>

  </body>
</html>