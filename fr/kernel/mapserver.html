<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Comment utiliser le support W*S MapServer interne &mdash; ZOO Project 1.3 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="ZOO Project 1.3 documentation" href="../index.html" />
    <link rel="up" title="Documentation du Kernel ZOO" href="index.html" />
    <link rel="next" title="Documentation de services ZOO" href="../services/index.html" />
    <link rel="prev" title="Mac OS X" href="install-mac.html" />

<script type="text/javascript">
$(document).ready(function(){

	$("ul.topnav li a").hover(function() {

		//Following events are applied to the subnav itself (moving subnav up and down)
		$(this).parent().find("ul.subnav").slideDown('fast').show(); //Drop down the subnav on click

		$(this).parent().hover(function() {
		}, function(){
			$(this).parent().find("ul.subnav").slideUp('slow'); //When the mouse hovers out of the subnav, move it back up
		});

		//Following events are applied to the trigger (Hover events for the trigger)
		}).hover(function() {
			$(this).addClass("subhover"); //On hover over, add class "subhover"
		}, function(){	//On Hover Out
			$(this).removeClass("subhover"); //On hover out, remove class "subhover"
	});

});
</script>

     

  </head>
  <body>
<!-- Begin Header -->
<div id="wrapper">
  	<div id="myheader">
    	<div class="hleft">
    	  <h1 class="title">Open WPS Platform</h1>
    	</div>
    	<div class="hright">
    	</div>
  	</div>
</div>
<ul class="topnav">
  <li><a href="http://www.zoo-project.org/">Home</a></li>
  <li><a href="#">ZOO Project</a>
       <ul class="subnav">

         <li><a href="/site/ZooWebSite/ZooProject/About">About</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Tribe">ZOO Tribe</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Events">Events</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Photos">Photos</a></li>
         <li><a href="/site/ZooWebSite/ZooProject/Contact">Contacts</a></li>
       </ul>

  </li>
  <li>
    <a href="#">Components</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/ZooKernel">ZOO Kernel</a></li>
      <li><a href="/site/ZooWebSite/ZooServices">ZOO Services</a></li>
      <li><a href="/site/ZooWebsite/ZooApi">ZOO API</a></li>

    </ul>
  </li>
  <li><a href="/site/Downloads">Download</a></li>
  <li><a href="#">Docs</a>
    <ul class="subnav">
      <li><a href="../../en/index.html">English</a></li>
      <li><a href="../../fr/index.html">Français</a></li>
    </ul>
  </li>
  <li><a href="#">Demos</a>
    <ul class="subnav">
      <li><a href="/site/ZooWebSite/Demo/SpatialTools">ZOO Spatial Tools</a></li>

      <li><a href="/site/ZooWebSite/Demo/CGAL">ZOO CGAL Vor</a></li>
      <li><a href="/site/ZooWebSite/Demo/WFS-T">ZOO Mapserver WFS-T</a></li>
      <li><a href="/site/ZooWebSite/Demo/GdalProfile">ZOO Elevation Profile</a></li>
      <li><a href="/site/ZooWebSite/Demo/FormTools">ZOO Form tools</a></li>
    </ul>
  </li>
  <li><a href="/trac">Trac</a></li>
</ul>
<!-- End Header -->
    

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="Index général"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../services/index.html" title="Documentation de services ZOO"
             accesskey="N">suivant</a> |</li>
        <li class="right" >
          <a href="install-mac.html" title="Mac OS X"
             accesskey="P">précédent</a> |</li>
        <li><a href="../index.html">ZOO Docs</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Documentation du Kernel ZOO</a> &raquo;</li> 
      </ul>
    </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="how-to-use-the-internal-mapserver-w-s-support">
<span id="kernel-mapserver"></span><h1><a class="toc-backref" href="#table-of-contents">Comment utiliser le support W*S MapServer interne</a><a class="headerlink" href="#how-to-use-the-internal-mapserver-w-s-support" title="Lien permanent vers ce titre">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Authors:</th><td class="field-body">Nicolas Bozon, Gérald Fenoy, Jeff McKenna</td>
</tr>
<tr class="field-even field"><th class="field-name">Last Updated:</th><td class="field-body">$Date$</td>
</tr>
</tbody>
</table>
<p>L&#8217;idée clé de l&#8217;implémentation du support W*S MapServer est qu&#8217;elle ne nécessite pas de changer une seule ligne du code source du service pour activer la publication automatique de votre résultat en tant que ressource WMS/WFS ou WCS. Vous avez simplement besoin de modifier le fichier <tt class="docutils literal"><span class="pre">zcfg</span></tt> correspondant à votre service pour le faire fonctionner.</p>
<p>Vous trouverez ici un aperçu de la manière d&#8217; installer le support W*S MapServer, la configuration requise et les mécanismes internes.</p>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table des matières</p>
<ul class="simple">
<li><a class="reference internal" href="#how-to-use-the-internal-mapserver-w-s-support" id="id1">Comment utiliser le support W*S MapServer interne</a><ul>
<li><a class="reference internal" href="#how-to-make-it-working" id="id2">Comment le faire fonctionner ?</a><ul>
<li><a class="reference internal" href="#requirement" id="id3">Prérequis</a></li>
<li><a class="reference internal" href="#installation-steps" id="id4">Etapes d&#8217;installation</a></li>
<li><a class="reference internal" href="#configuration-steps" id="id5">Etapes de configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-does-it-work" id="id6">Comment cela fonctionne-t-il ?</a></li>
<li><a class="reference internal" href="#simple-sample-use-cases" id="id7">Cas d&#8217;utilisations exemples simples</a><ul>
<li><a class="reference internal" href="#testings" id="id8">Essais</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="how-to-make-it-working">
<h2><a class="toc-backref" href="#table-of-contents">Comment le faire fonctionner ?</a><a class="headerlink" href="#how-to-make-it-working" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="requirement">
<h3><a class="toc-backref" href="#table-of-contents">Prérequis</a><a class="headerlink" href="#requirement" title="Lien permanent vers ce titre">¶</a></h3>
<blockquote>
<div><ul class="simple">
<li><p class="first">version trunk du dernier ZOO-Kernel</p>
</li>
<li><p class="first">Version de MapServer &gt;= 6.0.1</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="installation-steps">
<h3><a class="toc-backref" href="#table-of-contents">Etapes d&#8217;installation</a><a class="headerlink" href="#installation-steps" title="Lien permanent vers ce titre">¶</a></h3>
<p>En premier, téléchargez le dernier répertoire zoo-kernel disponible sur le svn. Faites ça depuis le répertoire de votre précédent checkout (où les répertoires zoo-api, zoo-services et zoo-kernel sont disponibles), nous utiliserons <tt class="docutils literal"><span class="pre">&lt;PREV_SVN_CO&gt;</span></tt> ici pour ce répertoire:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="nx">cd</span> <span class="o">&lt;</span><span class="nx">PREV_SVN_CO</span><span class="o">&gt;</span>
<span class="nx">svn</span> <span class="nx">checkout</span> <span class="nx">http</span><span class="p">:</span><span class="c1">//svn.zoo-project.org/svn/trunk/zoo-kernel zoo-kernel-ms</span>
</pre></div>
</div>
<p>Décompressez l&#8217;archive MapServer (c&#8217;est à dire <tt class="docutils literal"><span class="pre">mapserver-6.0.1.tar.bz2</span></tt>) dans <tt class="docutils literal"><span class="pre">/tmp/zoo-ms-src</span></tt>, puis compilez MapServer en utilisant la commande suivante:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">cd</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">zoo</span><span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">mapserver</span><span class="o">-</span><span class="mf">6.0.1</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">ogr</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gdal</span><span class="o">-</span><span class="n">config</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">gdal</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">gdal</span><span class="o">-</span><span class="n">config</span> \
               <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">proj</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">curl</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">sos</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">wfsclient</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">wmsclient</span> \
               <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">wcs</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">wfs</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">postgis</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">kml</span><span class="o">=</span><span class="n">yes</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">geos</span> \
               <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">xml</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">xslt</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">threads</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">cairo</span>
<span class="n">make</span>
<span class="n">cp</span> <span class="n">mapserv</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">bin</span>
</pre></div>
</div>
<p>Autotools a été mis à jour pour ajouter l&#8217;option configure <tt class="docutils literal"><span class="pre">--with-mapserver</span></tt>. Depuis le répertoire trunk SVN de votre ZOO-Project, compilez le ZOO-Kernel en utilisant la commande suivante:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">cd</span> <span class="n">zoo</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">ms</span>
<span class="n">autoconf</span>
<span class="p">.</span><span class="o">/</span><span class="n">configure</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">python</span> <span class="o">--</span><span class="n">with</span><span class="o">-</span><span class="n">mapserver</span><span class="o">=/</span><span class="n">tmp</span><span class="o">/</span><span class="n">zoo</span><span class="o">-</span><span class="n">ms</span><span class="o">-</span><span class="n">src</span><span class="o">/</span><span class="n">mapserver</span><span class="o">-</span><span class="mf">6.0.1</span>
<span class="n">make</span>
<span class="n">cp</span> <span class="n">zoo_loader</span><span class="p">.</span><span class="n">cgi</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">cgi</span><span class="o">-</span><span class="n">bin</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration-steps">
<h3><a class="toc-backref" href="#table-of-contents">Etapes de configuration</a><a class="headerlink" href="#configuration-steps" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="main-configuration-file">
<h4>Fichier de configuration principal<a class="headerlink" href="#main-configuration-file" title="Lien permanent vers ce titre">¶</a></h4>
<dl class="docutils">
<dt>Ajoutez le contenu suivant à votre fichier <tt class="docutils literal"><span class="pre">/usr/lib/cgi-bin/main.cfg</span></tt></dt>
<dd><p class="first last">dans la section <tt class="docutils literal"><span class="pre">[main]</span></tt>:</p>
</dd>
</dl>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">dataPath</span> <span class="o">=</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">temp</span><span class="o">/</span>
<span class="n">mapserverAddress</span><span class="o">=</span><span class="n">http</span><span class="o">:</span><span class="c1">//localhost/cgi-bin/mapserv</span>
</pre></div>
</div>
<p>Le répertoire <tt class="docutils literal"><span class="pre">dataPath</span></tt> doit exister et être disponible en écriture pour l&#8217;utilisateur apache. Dans ce répertoire, un fichier <tt class="docutils literal"><span class="pre">symbols.sym</span></tt> doit être présent, contenant ce qui suit:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">SYMBOLSET</span>
<span class="n">SYMBOL</span>
  <span class="n">NAME</span> <span class="s">&quot;circle&quot;</span>
  <span class="n">TYPE</span> <span class="n">ellipse</span>
  <span class="n">FILLED</span> <span class="nb">true</span>
  <span class="n">POINTS</span>
    <span class="mi">1</span> <span class="mi">1</span>
  <span class="n">END</span>
<span class="n">END</span>
<span class="n">END</span>
</pre></div>
</div>
<p>Une seule définition de symbole est requise avec n&#8217;importe quel nom, utilisé pour la sortie du service WMS.</p>
<p>Maintenant, votre ZOO-Kernel a le support de MapServer prêt à être utilisé. Notez que si vous n&#8217;ajoutez pas <tt class="docutils literal"><span class="pre">mapserverAddress</span></tt> alors cela impliquera une erreur de segmentation du ZOO-Kernel (la vérification de la valeur <tt class="docutils literal"><span class="pre">NULL</span></tt> devrait corriger ce comportement).</p>
<p>Ici vous pouvez optionnellement ajouter un paramètre <tt class="docutils literal"><span class="pre">msOgcVersion</span></tt> pour spécifier quelle version du WebService OGC vous voulez utiliser pour chaque service. Par exemple, si vous voulez forcer la version 1.0.0, vous pouvez définir ce qui suit dans la section <tt class="docutils literal"><span class="pre">[main]</span></tt> de votre fichier <tt class="docutils literal"><span class="pre">main.cfg</span></tt>:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">msOgcVersion</span><span class="o">=</span><span class="mf">1.0.0</span>
</pre></div>
</div>
</div>
<div class="section" id="service-configuration-file">
<h4>Fichier de configuration de service<a class="headerlink" href="#service-configuration-file" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour activer les sorties des WebServices MapServer pour un service, vous devez ajouter un paramètre spécifique dans le bloc <tt class="docutils literal"><span class="pre">&lt;Default&gt;</span></tt> ou <tt class="docutils literal"><span class="pre">&lt;Supported&gt;</span></tt>: <tt class="docutils literal"><span class="pre">useMapserver</span></tt>. Cela peut prendre la valeur true ou ne doit pas apparaître. Si true, cela signifie que le résultat en sortie est un source de données compatible OGR / GDAL et que vous voulez qu&#8217;elle soit mise à disposition comme une instance de serveur web OGC (WMS/WFS/WCS).</p>
<p>Vous obtenez un paramètre optionnel, pour utiliser un bloc de style MapServer personnalisé (utilisé pour les sources de données vecteur seulement): msStyle. Par exemple:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">msStyle</span> <span class="o">=</span> <span class="n">STYLE</span> <span class="n">COLOR</span> <span class="mi">125</span> <span class="mi">0</span> <span class="mi">105</span> <span class="n">OUTLINECOLOR</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="n">WIDTH</span> <span class="mi">3</span> <span class="n">END</span>
</pre></div>
</div>
<p>Vous avez le même paramètre optionnel <tt class="docutils literal"><span class="pre">msOgcVersion</span></tt> comme pour le <tt class="docutils literal"><span class="pre">main.cfg</span></tt>. Il spécifiera que c&#8217;est la version du protocole spécifique que le service veut utiliser (ainsi, vous pourrez peut être aussi définir localement le service plutôt que globalement).</p>
<p>Quand vous ajoutez l&#8217;option useMapserver à un bloc de sortie <tt class="docutils literal"><span class="pre">&lt;Default&gt;</span></tt> ou <tt class="docutils literal"><span class="pre">&lt;Supported&gt;</span></tt>, alors vous devez savoir quels sont les mimeType sensibles:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first">text/xml: implique que la donnée en sortie sera accessible via une requête GetFeature WFS (le protocole par défaut est la version 1.1.0)</p>
</li>
<li><p class="first">image/tiff: implique que la donnée en sortie sera accessible via une requête GetCoverage WCS (le protocole par défaut est la version 2.0.0)</p>
</li>
<li><p class="first">n&#8217;importe quel autre type de mimeType couplé avec l&#8217;option useMapserver: implique que la donnée en sortie sera accessible via une requête GetMap WMS (vous avez à vous limiter à ce que votre installation MapServer supporte, un requête GetCapabilities renvoie l&#8217;information sur les mimeType supportés en sortie) (le protocole par défaut est la version 1.3.0)</p>
</li>
</ul>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="how-does-it-work">
<h2><a class="toc-backref" href="#table-of-contents">Comment cela fonctionne-t-il ?</a><a class="headerlink" href="#how-does-it-work" title="Lien permanent vers ce titre">¶</a></h2>
<p>Quoi que votre service retourne comme sortie <tt class="docutils literal"><span class="pre">mimeType</span></tt> par défaut, celui-ci sera utilisé quand une sortie incluant l&#8217;option <tt class="docutils literal"><span class="pre">useMapserver</span></tt> a été trouvée.</p>
<p>Ainsi si vous avez les blocs suivants <tt class="docutils literal"><span class="pre">&lt;Default&gt;</span></tt> et <tt class="docutils literal"><span class="pre">&lt;Supported&gt;</span></tt> dans le fichier de configuration ZOO de votre service:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="nt">&lt;Default&gt;</span>
 mimeType = text/xml
 encoding = UTF-8
 schema = http://schemas.opengis.net/gml/3.1.0/base/feature.xsd
<span class="nt">&lt;/Default&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = image/png
 useMapserver = true
<span class="nt">&lt;/Supported&gt;</span>
</pre></div>
</div>
<p>Cela signifie que par défaut, votre service retourne des objets GML 3.1. Quand le client demande un <tt class="docutils literal"><span class="pre">mimeType=image/png</span></tt>, alors le ZOO-Kernel détectera que ce <tt class="docutils literal"><span class="pre">mimeType</span></tt> a l&#8217;option <tt class="docutils literal"><span class="pre">useMapServer</span></tt> définie à true, ainsi il:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p class="first">exécutera le service utilisant la définition du bloc <tt class="docutils literal"><span class="pre">&lt;Default&gt;</span></tt> (cela doit être compréhensible pour GDAL/OGR)</p>
</li>
<li><p class="first">stockera le résultat du service sur le disque (dans  <tt class="docutils literal"><span class="pre">[main]</span></tt> &gt; répertoire <tt class="docutils literal"><span class="pre">dataPath</span></tt>)</p>
</li>
<li><p class="first">écrira un Mapfile (dans le <tt class="docutils literal"><span class="pre">[main]</span></tt> &gt; répertoire <tt class="docutils literal"><span class="pre">dataPath</span></tt>) utilisant API C de MapServer pour configurer à la fois les services WMS et WFS.</p>
</li>
</ol>
</div></blockquote>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">même si vous ne demandez pas cela, le Mapfile résultant inclue à la fois la configuration pour le WMS et le WFS dans le cas des sources de données vecteur.</p>
</div>
<p>Si votre sortie de service renvoie un fichier raster, alors le comportement est assez similaire excepté que le ZOO-Kernel configurera à la fois les services WMS et WCS pour le résultat du service. Ici vous ne pouvez définir votre propre style. Cependant, quand une bande raster est retournée alors le  ZOO-Kernel peut utiliser ses propres définitions par défaut pour classifier le raster en utilisant des intervalles équivalents (vous pouvez facilement voir cela dans le Mapfile produit), cette classification est spécifique au protocole WMS. Vous devriez ajouter un paramètre <tt class="docutils literal"><span class="pre">msClassify</span></tt> et le définir à <tt class="docutils literal"><span class="pre">true</span></tt> dans votre noeud ComplexData de sortie <tt class="docutils literal"><span class="pre">&lt;Default&gt;</span></tt> ou <tt class="docutils literal"><span class="pre">&lt;Supported&gt;</span></tt> pour activer cette classification. Note spéciale  pour les implémentations clientes</p>
<p>Notez qu&#8217;en fonction de la requête, le ZOO-Kernel peut retourner un en-tête d&#8217;emplacement.</p>
<p>Différents types de requêtes:</p>
<blockquote>
<div><ul class="simple">
<li><p class="first"><a class="reference external" href="mailto:ResponseDocument=XXXX&#37;&#52;&#48;asReference=true">ResponseDocument=XXXX<span>&#64;</span>asReference=true</a> - dans ce cas, le Kernel retournera la requête GetMap/GetFeature/GetCoverage sous forme KVP dans le href du résultat.</p>
</li>
<li><p class="first"><a class="reference external" href="mailto:ResponseDocument=XXXX&#37;&#52;&#48;asReference=false">ResponseDocument=XXXX<span>&#64;</span>asReference=false</a> - dans ce cas, le Kernel retournera le résultat qu&#8217;il obtiendra en utilisant la requête GetMap/GetFeature/GetCoverage sous forme KVP utilisée pour le href dans le cas précédent.</p>
</li>
<li><p class="first"><a class="reference external" href="mailto:RawDataOutput=XXXX&#37;&#52;&#48;asReference=true/false">RawDataOutput=XXXX<span>&#64;</span>asReference=true/false</a> - dans ce cas, le Kernel retournera la requête GetMap/GetFeature/GetCoverage sous forme KVP dans l&#8217;en-tête d&#8217;emplacement spécifique, qui implique que le navigateur doive suivre et interroger MapServer directement.</p>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="simple-sample-use-cases">
<h2><a class="toc-backref" href="#table-of-contents">Cas d&#8217;utilisations exemples simples</a><a class="headerlink" href="#simple-sample-use-cases" title="Lien permanent vers ce titre">¶</a></h2>
<p>Considérez le service existant BufferPy de zoo-services/ogr-base-vect-ops-py. Définissez le contenu suivant vers votre fichier BufferPy.zcfg local  dans la définition de sortie Result, ensuite copiez-le dans /usr/lib/cgi-bin/:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="nt">&lt;Default&gt;</span>
 mimeType = text/xml
 encoding = UTF-8
 schema = http://schemas.opengis.net/gml/3.1.0/base/feature.xsd
 useMapserver = true
<span class="nt">&lt;/Default&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = image/png
 useMapserver = true
 asReference = true
 msStyle = STYLE COLOR 125 0 105 OUTLINECOLOR 0 0 0 WIDTH 3 END
<span class="nt">&lt;/Supported&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = image/tif
 useMapserver = true
 asReference = true
 msStyle = STYLE COLOR 125 0 105 OUTLINECOLOR 0 0 0 WIDTH 3 END
<span class="nt">&lt;/Supported&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = application/vnd.google-earth.kmz
 useMapserver = true
 asReference = true
 msStyle = STYLE COLOR 125 0 105 OUTLINECOLOR 0 0 0 WIDTH 3 END
<span class="nt">&lt;/Supported&gt;</span>
</pre></div>
</div>
<p>Ces modifications rendent votre service prêt pour retourner les résultats comme requêtes GetMap WMS ou GetFeature WFS. Notez que certains bugs ont lieu localement en utilisant la sortie application/vnd.google-earth.kmz.</p>
<p>En utilisant le code de service simple suivant, nous obtenons un service capable de produire en sortie n&#8217;importe quel type de fichiers internet (utile pour tester cette fonctionnalité):</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="n">import</span> <span class="n">zoo</span>
<span class="n">def</span> <span class="n">HelloPy</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span><span class="n">inputs</span><span class="p">,</span><span class="n">outputs</span><span class="p">)</span><span class="o">:</span>
        <span class="n">outputs</span><span class="p">[</span><span class="s">&quot;Result&quot;</span><span class="p">][</span><span class="s">&quot;value&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">inputs</span><span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">][</span><span class="s">&quot;value&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">zoo</span><span class="p">.</span><span class="n">SERVICE_SUCCEEDED</span>
</pre></div>
</div>
<p>Définissez la sortie <tt class="docutils literal"><span class="pre">[Result]</span></tt> dans votre fichier <tt class="docutils literal"><span class="pre">HelloPy.zcfg</span></tt> avec le contenu du bloc ComplexData suivant:</p>
<div class="highlight-guess"><div class="highlight"><pre><span class="nt">&lt;Default&gt;</span>
 mimeType = image/png
 useMapServer = true
<span class="nt">&lt;/Default&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = image/tiff
 useMapServer = true
<span class="nt">&lt;/Supported&gt;</span>
<span class="nt">&lt;Supported&gt;</span>
 mimeType = text/xml
 useMapServer = true
<span class="nt">&lt;/Supported&gt;</span>
</pre></div>
</div>
<p>Cela signifie que <tt class="docutils literal"><span class="pre">mimeType</span></tt> en sortie par défaut est <tt class="docutils literal"><span class="pre">image/png</span></tt>, ainsi une requête GetMap WMS sera retournée, ou l&#8217;<tt class="docutils literal"><span class="pre">image/tiff</span></tt> résultante sera retournée comme une requête GetCoverage WCS.</p>
<p>Avec ce simple service, vous pouvez tester les nouvelles capacités à produire un résultat comme un WebServices pour chacun des mimeTypes. Notez, que que vous aurez probablement un <tt class="docutils literal"><span class="pre">mimeType</span></tt> faux, comme celui par défaut a été défini à <tt class="docutils literal"><span class="pre">image/png</span></tt>.</p>
<p>Il y a un support pour les ShapeFiles zippés mais je doute qu&#8217;il soit vraiment utile. De toute façon, comme il est présent vous pouvez le tester facilement en passant un fichier zip dans <tt class="docutils literal"><span class="pre">xlink:href</span></tt> pour la valeur <tt class="docutils literal"><span class="pre">a</span></tt> du service <tt class="docutils literal"><span class="pre">HelloPy</span></tt>.</p>
<div class="section" id="testings">
<h3><a class="toc-backref" href="#table-of-contents">Essais</a><a class="headerlink" href="#testings" title="Lien permanent vers ce titre">¶</a></h3>
<p>En utilisant le code de service <tt class="docutils literal"><span class="pre">HelloPy</span></tt> simple, vous pouvez utiliser les urls suivantes, notez que cela suppose que vous ayez un fichier <a class="reference external" href="http://localhost/data/data.zip">http://localhost/data/data.zip</a> disponible contenant un ShapeFile et un <a class="reference external" href="http://localhost/data/demo.tif">http://localhost/data/demo.tif</a>:</p>
<div class="section" id="test-1-accessing-a-remote-zipped-shapefile-as-wfs-getfeatures-request">
<h4>Test 1: Accéder à un Shapefile distant zippé en tant que requête GetFeatures WFS<a class="headerlink" href="#test-1-accessing-a-remote-zipped-shapefile-as-wfs-getfeatures-request" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-guess"><div class="highlight"><pre><span class="nl">http:</span><span class="c1">//localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=HelloPy&amp;DataInputs=a=Reference@xlink:href=http://localhost/data/data.zip&amp;ResponseDocument=Result@asReference=true@mimetype=text/xml</span>
</pre></div>
</div>
</div>
<div class="section" id="test-2-accessing-a-remote-zipped-shapefile-as-wms-getmap-request">
<h4>Test 2: Accéder à un Shapefile distant zippé en tant que requête GetMap WMS<a class="headerlink" href="#test-2-accessing-a-remote-zipped-shapefile-as-wms-getmap-request" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-guess"><div class="highlight"><pre><span class="nl">http:</span><span class="c1">//localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=HelloPy&amp;DataInputs=a=Reference@xlink:href=http://localhost/data/data.zip&amp;ResponseDocument=Result@asReference=true@mimetype=image/png</span>
</pre></div>
</div>
</div>
<div class="section" id="test-3-accessing-a-remote-tiff-as-wms-getmap-request">
<h4>Test 3: Accéder à un tiff distant en tant que requête GetMap WMS:<a class="headerlink" href="#test-3-accessing-a-remote-tiff-as-wms-getmap-request" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-guess"><div class="highlight"><pre><span class="nl">http:</span><span class="c1">//localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=HelloPy&amp;DataInputs=a=Reference@xlink:href=http://localhost/data/data.tiff&amp;ResponseDocument=Result@asReference=true@mimetype=image/png</span>
</pre></div>
</div>
</div>
<div class="section" id="test-4-accessing-a-remote-tiff-as-wcs-getmap-request">
<h4>Test 4: Accéder à un tiff distant en tant que requête GetMap WCS:<a class="headerlink" href="#test-4-accessing-a-remote-tiff-as-wcs-getmap-request" title="Lien permanent vers ce titre">¶</a></h4>
<div class="highlight-guess"><div class="highlight"><pre><span class="nl">http:</span><span class="c1">//localhost/cgi-bin/zoo_loader.cgi?request=Execute&amp;service=WPS&amp;version=1.0.0&amp;Identifier=HelloPy&amp;DataInputs=a=Reference@xlink:href=http://localhost/data/data.tiff&amp;ResponseDocument=Result@asReference=true@mimetype=image/tiff</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table des Matières</a></h3>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Documentation du Kernel ZOO</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Comment utiliser le support W*S MapServer interne</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-make-it-working">Comment le faire fonctionner ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-does-it-work">Comment cela fonctionne-t-il ?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simple-sample-use-cases">Cas d&#8217;utilisations exemples simples</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../services/index.html">Documentation de services ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">ZOO API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshop/2010/index.html">Workshop: Practical Introduction to ZOO: The Open WPS Platform</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshop/2012/index.html">Practical Introduction to ZOO-Project by playing with building blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../workshop/2013/index.html">ZOO-Project: jouer avec des blocs de construction pour construire une application web pgRouting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../community/index.html">Communauté ZOO</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development/documentation.html">Guide de développement de la documentation</a></li>
</ul>

<div id="searchbox" style="display: none">
  <h3>Recherche rapide</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Saisissez un mot clef ou un nom de module, classe ou fonction.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
<!-- Begin Footer -->
<div id="footer">
<div>

<div>
  <div class="menuContainer">
    <div class="menuItemList">
      <a href="../index.html" shape="rect">Home</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">ZOO Project</a>

      <br/>
      <a href="/site/ZooWebSite/ZooProject/About" shape="rect">About</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Tribe" shape="rect">ZOO Tribe</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Events" shape="rect">Events</a>
      <br/>

      <a href="/site/ZooWebSite/ZooProject/Photos" shape="rect">Photos</a>
      <br/>
      <a href="/site/ZooWebSite/ZooProject/Contact" shape="rect">Contacts</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Components</a>

      <br/>
      <a href="/site/ZooWebSite/ZooKernel" shape="rect">ZOO Kernel</a>
      <br/>
      <a href="/site/ZooWebSite/ZooServices" shape="rect">ZOO Services</a>
      <br/>
      <a href="/site/ZooWebsite/ZooApi" shape="rect">ZOO API</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="../dl/index.html" shape="rect">Download</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Docs</a>

      <br/>
      <a href="../doc/en/index.html" shape="rect">English version</a>
      <br/>
      <a href="../doc/fr/index.html" shape="rect">version française</a>
      <br/>

    </div>
    <div class="menuItemList">
      <a href="#" shape="rect">Demos</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/SpatialTools" shape="rect">ZOO Spatial Tools</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/WFS-T" shape="rect">ZOO Mapserver WFS-T</a>

      <br/>
      <a href="/site/ZooWebSite/Demo/GdalProfile" shape="rect">ZOO Elevation Profile</a>
      <br/>
      <a href="/site/ZooWebSite/Demo/FormTools" shape="rect">ZOO Form tools</a>
      <br/>
    </div>
    <div class="menuItemList">
      <a href="/trac" shape="rect">Trac</a>

      <br/>
    </div>
  </div>
  <br style="clear:both"/>
</div>
</div>
<p>
&copy; Copyright 2011 - <a class="ext-link" href="http://www.zoo-project.org" shape="rect"><span class="icon"> </span>ZOO Project</a> - All Rights Reserved. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2b3.
</p>
</div>
<!-- End Footer -->
    
    <div class="footer">
    </div>

  </body>
</html>